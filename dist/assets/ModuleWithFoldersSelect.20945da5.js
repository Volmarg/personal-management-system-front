import{b as e,a as t,S as l,s}from"./StorageState.cb1f6c06.js";import{_ as o}from"./ResponseHandlerMixin.69e9e767.js";import{aF as a,aG as r,_ as i,aM as n,ah as d,a2 as h,U as c,r as u,o as p,e as f,f as g,Y as m,g as b}from"./index.daf34ba3.js";const O={data:()=>({store:null,dirsStructure:[]}),mixins:[o],methods:{async getDirsStructure(e){this.store.moduleName=e,await this.store.getAll(),this.dirsStructure=this.store.allEntries},async addFolder(t,l){let s={parentDir:t,newDirName:l},o=e.buildUrl(e.FOLDER_CREATE_URL);return this.$axios.post(o,s).then((e=>this.handleResponse(e)))},async renameFolder(t,l){let s={currDirPath:t,newDirName:l},o=e.buildUrl(e.FOLDER_RENAME_URL);return this.$axios.post(o,s).then((e=>this.handleResponse(e)))},async moveOrCopyDir(t,l,s,o){let a={currDirPath:t,newDirParentPath:l,move:s,targetModuleName:o},r=e.buildUrl(e.FOLDER_MOVE_OR_COPY_URL);return this.$axios.post(r,a).then((e=>this.handleResponse(e)))}},beforeMount(){this.store=t()},watch:{"store.allEntries":{deep:!0,handler:function(){this.dirsStructure=this.store.allEntries}}}},C=a("storageModulesStates",{state:()=>({allEntries:[]}),actions:{async getAll(){this.allEntries=await(new r).getAll(e.FOLDER_BASE_URL)}}}),S={class:"flex flex-wrap flex-col"},M={class:"w-full self-center"};var w=i({data:()=>({folderPathOptions:[],categories:[],selectedModule:null,selectedFolderPath:null,isVisible:!0,storage:null}),emits:["moduleSelectChange","folderSelectChange"],components:{MultiSelect:n},computed:{moduleOptions(){var e;let t=[];for(let o of Object.keys(l).filter((e=>isNaN(e)))){let l=s(o),a=null!=(e=d.MODULE_ACCESS_RIGHTS[l])?e:null;if(!a)throw new h(`No right was defined for module ${l}`);(new c).isModuleAccessGranted(a)&&t.push({label:this.$t(`navbar.rightSidebar.menu.${o}.label`),selectedLabel:this.$t(`navbar.rightSidebar.menu.${o}.label`),value:o})}return t}},methods:{getFolderLevel(e,t,l="",s=null){if(null===s&&(s=1),!l&&t.path===e)return s;let o=e.split("/"),a=[`${o[0]}/${o[1]}`];for(let r in o)0!=r&&1!=r&&a.push(o[r]);if(a=a.filter(Boolean),(l+=(1!=s?"/":"")+`${a[s-1]}`)===e)return s;if(t.path===e)return s;if(t.path===l)return s++,this.getFolderLevel(e,t,l,s);for(let r of t.children){if(r.path===e)return s;if(r.path===l)return s++,this.getFolderLevel(e,r,l,s)}throw new Error(`Could not find node with matching path: ${e}`)},traverseTree(){if(!this.selectedModule)return;let e=this.storage.allEntries[this.selectedModule];for(let t of e)this.addOption(t,0),this.traverseNode(t)},traverseNode(e){if(e.children)for(let t of e.children){if(!this.folderPathOptions.find((e=>e.value==t.path))){let e=this.storage.allEntries[this.selectedModule][0],l=this.getFolderLevel(t.path,e);this.addOption(t,l)}this.traverseNode(t)}},addOption(e,t){this.folderPathOptions.push({label:"ã…¤".repeat(t)+e.dirname,selectedLabel:e.dirname,value:e.path})},onModuleOptionChanged(e){this.selectedModule=e,this.$emit("moduleSelectChange",e)},onFolderOptionChanged(e){this.selectedFolderPath=e,this.$emit("folderSelectChange",e)},reload(){this.isVisible=!1,this.selectedModule=null,this.selectedFolderPath=null,this.$nextTick((async()=>{await this.storage.getAll(),this.traverseTree(),this.isVisible=!0}))}},mounted(){this.value=this.selected},async created(){this.storage=C(),await this.storage.getAll(),this.traverseTree()},watch:{"storage.allEntries":{deep:!0,handler:function(){this.selectedModule=null,this.selectedFolderPath=null,this.$nextTick((async()=>{this.traverseTree()}))}},selectedModule(){this.$refs.folderSelect.clear(),this.$nextTick((()=>{this.folderPathOptions=[],this.$emit("folderSelectChange",this.selectedFolderPath),this.traverseTree()}))}}},[["render",function(e,t,l,s,o,a){const r=u("MultiSelect");return p(),f("div",S,[g("div",M,[o.isVisible?(p(),m(r,{key:0,label:e.$t("storage.modulePathsSelect.label.modules"),"selected-label-source":"selectedLabel",options:a.moduleOptions,onChange:a.onModuleOptionChanged,onSelect:a.onModuleOptionChanged,onDeselect:a.onModuleOptionChanged,onClear:a.onModuleOptionChanged,onPaste:a.onModuleOptionChanged,modelValue:o.selectedModule,"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedModule=e),mode:"single","allow-show-options-list":!0,"allow-create-options":!1,"can-clear":!1,required:!0,class:"module-with-folder-select",ref:"moduleSelect"},null,8,["label","options","onChange","onSelect","onDeselect","onClear","onPaste","modelValue"])):b("",!0),o.isVisible?(p(),m(r,{key:1,label:e.$t("storage.modulePathsSelect.label.folderName"),"selected-label-source":"selectedLabel",options:o.folderPathOptions,onChange:a.onFolderOptionChanged,onSelect:a.onFolderOptionChanged,onDeselect:a.onFolderOptionChanged,onClear:a.onFolderOptionChanged,onPaste:a.onFolderOptionChanged,modelValue:o.selectedFolderPath,"onUpdate:modelValue":t[1]||(t[1]=e=>o.selectedFolderPath=e),mode:"single","allow-show-options-list":!0,"allow-create-options":!1,"can-clear":!1,required:!0,class:"mt-4 module-with-folder-select",ref:"folderSelect"},null,8,["label","options","onChange","onSelect","onDeselect","onClear","onPaste","modelValue"])):b("",!0)])])}]]);export{w as M,O as _};
