import{_ as e}from"./ModuleBaseDataMixin.33f48fec.js";import{M as t,_ as o}from"./ModuleWithFoldersSelect.20945da5.js";import{_ as l,M as i,a0 as s,a1 as a,r as d,o as n,e as r,h as c,k as u,I as m,f as p,aP as h,bo as f,t as g,aa as b,af as v,p as M,l as x,b8 as C,R as F,X as $,Y as y,j as k,n as N,g as S,c as w,aU as D,W as R,aK as V,aX as B,aB as T}from"./index.daf34ba3.js";import{_ as A}from"./ResponseHandlerMixin.69e9e767.js";import{a as L,b as W,S as _}from"./StorageState.cb1f6c06.js";import{U as q}from"./UploadDialog.0745d2ec.js";import{F as I,a as U}from"./FloatingBox.0f7c8591.js";import{S as O}from"./SearchInput.c3a307a8.js";import{P as E}from"./PublicFolderService.55b79576.js";import{T as j}from"./Upload.aa3868c7.js";import{C as z}from"./ClipboardService.5a9eb047.js";var P=l({data:()=>({showModal:!1,selectedModule:null,selectedPath:null}),props:{isModalVisible:{type:Boolean,required:!0,default:!1}},components:{MediumButtonWithIcon:i,Modal:s,ModuleWithFoldersSelect:t},mixins:[a,A],emits:["modalClosed","confirmClick"],computed:{selectedFiles:()=>L().selectedFilesData},methods:{onModalClosed(){this.$emit("modalClosed")},onSubmit(){let e=[];for(let l of this.selectedFiles){let t=l.name+(l.ext?`.${l.ext}`:"");e.push(t)}let t={fileNames:e,newDirPath:this.selectedPath,currDirPath:this.$route.query.dir},o=W.buildUrl(W.FILE_MOVE_URL);this.$axios.post(o,t).then((e=>{this.handleResponse(e)&&(L().clearSelectedFiles(),L().getAll(),this.$emit("modalClosed"))}))}},updated(){this.showModal=this.isModalVisible}},[["render",function(e,t,o,l,i,s){const a=d("ModuleWithFoldersSelect"),m=d("MediumButtonWithIcon"),p=d("Modal");return n(),r("div",null,[c(p,{"is-visible":i.showModal,id:"storage-file-move",title:e.$t("storage.page.module.moveModal.header"),onModalClosed:s.onModalClosed,onConfirm:s.onSubmit,size:e.modalSize},{content:u((()=>[c(a,{onModuleSelectChange:t[0]||(t[0]=e=>i.selectedModule=e),onFolderSelectChange:t[1]||(t[1]=e=>i.selectedPath=e)}),c(m,{text:e.$t("storage.page.module.moveModal.form.submit.label"),"button-extra-classes":"pt-3 pb-3 sm:pt-1 sm:pb-1",class:"w-full mb-1 md:col-start-1 md:col-end-2 mt-6","button-classes":"w-full md:w-auto m-0-force","text-classes":"text-center w-full",onButtonClick:s.onSubmit},null,8,["text","onButtonClick"])])),_:1},8,["is-visible","title","onModalClosed","onConfirm","size"])])}]]);const H={data:()=>({name:"",showModal:!1}),props:{isModalVisible:{type:Boolean,required:!0,default:!1}},components:{MediumButtonWithIcon:i,FormInput:m,Modal:s},mixins:[a,o],emits:["modalClosed","confirmClick"],methods:{onModalClosed(){this.$emit("modalClosed")},async onSubmit(){await this.addFolder(this.$route.query.dir,this.name,!0)&&(L().clearSelectedFiles(),L().getAll(),this.name="",this.$emit("modalClosed"))}},updated(){this.showModal=this.isModalVisible}},J={class:"flex justify-center"},G={class:"w-full flex flex-col"};var K=l(H,[["render",function(e,t,o,l,i,s){const a=d("FormInput"),m=d("MediumButtonWithIcon"),h=d("Modal");return n(),r("div",null,[c(h,{"is-visible":i.showModal,id:"add-folder",title:e.$t("storage.page.module.newFolderModal.header.label"),onModalClosed:s.onModalClosed,size:e.modalSize},{content:u((()=>[p("div",J,[p("div",G,[c(a,{type:"text","is-required":!0,label:e.$t("storage.page.module.newFolderModal.form.name.label"),modelValue:i.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.name=e)},null,8,["label","modelValue"]),c(m,{text:e.$t("storage.page.module.newFolderModal.form.submit.label"),"button-extra-classes":"pt-3 pb-3 sm:pt-1 sm:pb-1",class:"w-full mb-1 md:col-start-1 md:col-end-2 mt-6","button-classes":"w-full md:w-auto m-0-force","text-classes":"text-center w-full",onButtonClick:s.onSubmit},null,8,["text","onButtonClick"])])])])),_:1},8,["is-visible","title","onModalClosed","size"])])}]]);const X={emits:["modalClosed"],data:()=>({showModal:!1}),props:{isModalVisible:{type:Boolean,required:!0,default:!1}},components:{WarningModal:h,UnicodeArrow:f},mixins:[A,a],computed:{selectedFiles:()=>L().selectedFilesData},methods:{onModalClosed(){this.$emit("modalClosed")},onSubmit(){let e=[];for(let l of this.selectedFiles){let t=l.name+(l.ext?`.${l.ext}`:"");e.push(t)}let t={fileNames:e,dirPath:this.$route.query.dir},o=W.buildUrl(W.FILE_REMOVE_URL);this.$axios.post(o,t).then((e=>{this.handleResponse(e)&&(L().clearSelectedFiles(),L().getAll(),this.$emit("modalClosed"))}))}},updated(){this.showModal=this.isModalVisible}},Y={class:"mb-2"},Q=(oe=()=>p("hr",null,null,-1),M("data-v-9a593e5c"),oe=oe(),x(),oe),Z={class:"flex justify-center flex-row"},ee={class:"files-list"},te={class:"file-name"};var oe,le=l(X,[["render",function(e,t,o,l,i,s){const a=d("UnicodeArrow"),m=d("WarningModal");return n(),r("div",null,[c(m,{"is-visible":i.showModal,id:"storage-file-remove",title:e.$t("storage.page.module.removeModal.header.label"),onModalClosed:s.onModalClosed,onConfirm:s.onSubmit,size:e.modalSize},{content:u((()=>[p("p",Y,g(e.$t("storage.page.module.removeModal.description")),1),Q,p("div",Z,[p("ul",ee,[(n(!0),r(b,null,v(s.selectedFiles,(e=>(n(),r("li",{key:JSON.stringify(e),class:"flex flex-row"},[c(a,{class:"align-self-start mr-2"}),p("span",te,g(e.name)+" "+g(e.ext?`.${e.ext}`:""),1)])))),128))])])])),_:1},8,["is-visible","title","onModalClosed","onConfirm","size"])])}],["__scopeId","data-v-9a593e5c"]]),ie=l({data:()=>({storageState:null,showModal:!1,description:"",initialSmallSizeModal:"medium"}),props:{isModalVisible:{type:Boolean,required:!0,default:!1}},components:{MediumButtonWithIcon:i,Wyswig:C,Modal:s},mixins:[a,A],emits:["modalClosed","confirmClick"],methods:{onModalClosed(){this.$emit("modalClosed")},onSubmit(){this.description=this.$refs.wyswig.getContent();let e={moduleName:L().moduleName,description:this.description,dirPath:this.$route.query.dir},t=W.buildUrl(W.FOLDER_UPDATE_META_DATA);this.$axios.post(t,e).then((e=>{this.handleResponse(e)&&(L().clearSelectedFiles(),L().getAll(),this.$emit("modalClosed"))}))}},created(){this.storageState=L()},updated(){this.showModal=this.isModalVisible},watch:{"storageState.activeNodeData":{deep:!0,handler:function(){this.description=L().activeNodeData.description}}}},[["render",function(e,t,o,l,i,s){const a=d("Wyswig"),m=d("MediumButtonWithIcon"),p=d("Modal");return n(),r("div",null,[c(p,{"is-visible":i.showModal,id:"storage-settings",title:e.$t("storage.page.module.settingsModal.header"),onModalClosed:s.onModalClosed,size:e.modalSize},{content:u((()=>[c(a,{"initial-value":i.description,label:e.$t("storage.page.module.settingsModal.form.description.label"),ref:"wyswig"},null,8,["initial-value","label"]),c(m,{text:e.$t("storage.page.module.settingsModal.form.submit.label"),"button-extra-classes":"pt-3 pb-3 sm:pt-1 sm:pb-1",class:"w-full mb-1 md:col-start-1 md:col-end-2 mt-6","button-classes":"w-full md:w-auto m-0-force","text-classes":"text-center w-full",onButtonClick:s.onSubmit},null,8,["text","onButtonClick"])])),_:1},8,["is-visible","title","onModalClosed","size"])])}]]);const se={emits:["modalClosed"],data:()=>({showModal:!1}),props:{isModalVisible:{type:Boolean,required:!0,default:!1}},components:{WarningModal:h},mixins:[A,a],methods:{onModalClosed(){this.$emit("modalClosed")},onSubmit(){let e={dirPath:this.$route.query.dir},t=W.buildUrl(W.FOLDER_REMOVE_URL);this.$axios.post(t,e).then((e=>{this.handleResponse(e)&&(L().clearSelectedFiles(),L().getAll(),this.$emit("modalClosed"))}))}},updated(){this.showModal=this.isModalVisible}},ae={class:"mb-2"},de=["innerHTML"];var ne=l(se,[["render",function(e,t,o,l,i,s){const a=d("WarningModal");return n(),r("div",null,[c(a,{"is-visible":i.showModal,id:"storage-folder-remove",title:e.$t("storage.page.module.removeFolderModal.header.label"),onModalClosed:s.onModalClosed,onConfirm:s.onSubmit,size:e.modalSize},{content:u((()=>[p("p",ae,g(e.$t("storage.page.module.removeFolderModal.description.line1")),1),p("p",{class:"mb-2",innerHTML:e.$t("storage.page.module.removeFolderModal.description.line2")},null,8,de)])),_:1},8,["is-visible","title","onModalClosed","onConfirm","size"])])}]]),re=l({props:{isDisabled:{type:Boolean,default:!1}},components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"],mixins:[A],computed:{isLocked:()=>L().activeNodeData.isLocked},methods:{toggleLock(){let e={dir:this.$route.query.dir,moduleName:L().moduleName},t=W.buildUrl(W.FOLDER_TOGGLE_LOCK_URL);this.$axios.post(t,e).then((e=>{this.handleResponse(e)&&(L().clearSelectedFiles(),L().getAll())}))}}},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1,"background-color-class-name":s.isLocked?"bg-red-500":"bg-green-500",onClick:s.toggleLock},{icon:u((()=>[s.isLocked?(n(),y(a,{key:0,icon:"lock"})):(n(),y(a,{key:1,icon:"lock-open"}))])),_:1},8,["background-color-class-name","onClick"])])),_:1})),[[p,s.isLocked?e.$t("storage.nav.button.lock.unlock"):e.$t("storage.nav.button.lock.doLock")]])}]]),ce=l({components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"]},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1},{icon:u((()=>[c(a,{icon:"folder"}),c(a,{icon:"plus",class:"absolute -ml-5 mt-2.5 text-xs text-gray-500"})])),_:1})])),_:1})),[[p,e.$t("storage.nav.button.addFolder.label")]])}]]),ue=l({components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"]},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1},{icon:u((()=>[c(a,{icon:"upload"})])),_:1})])),_:1})),[[p,e.$t("storage.nav.button.uploadFile.label")]])}]]),me=l({components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"]},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1},{icon:u((()=>[c(a,{icon:"cog"})])),_:1})])),_:1})),[[p,e.$t("storage.nav.button.settings.label")]])}]]),pe=l({props:{isDisabled:{type:Boolean,default:!1}},components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"]},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1,"is-disabled":o.isDisabled,"background-color-class-name":"bg-red-500"},{icon:u((()=>[c(a,{icon:"trash"})])),_:1},8,["is-disabled"])])),_:1})),[[p,e.$t("storage.nav.button.delete.label")]])}]]),he=l({props:{isDisabled:{type:Boolean,default:!1}},components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"]},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1,"is-disabled":o.isDisabled},{icon:u((()=>[c(a,{icon:"random"})])),_:1},8,["is-disabled"])])),_:1})),[[p,e.$t("storage.nav.button.move.label")]])}]]),fe=l({data:()=>({uploadConfigId:L().uploadConfigId,isAddFolderModalVisible:!1,isRemoveFolderModalVisible:!1,isRemoveModalVisible:!1,isSettingsModalVisible:!1,isUploadModalVisible:!1,isMoveFilesModalVisible:!1}),components:{RemoveFolder:l({components:{FloatingBox:I,FullRoundButtonWithIcon:U},emits:["click"]},[["render",function(e,t,o,l,i,s){const a=d("fa"),r=d("FullRoundButtonWithIcon"),m=d("FloatingBox"),p=F("tippy");return $((n(),y(m,{"show-background":!1,onClick:t[0]||(t[0]=t=>e.$emit("click"))},{default:u((()=>[c(r,{"slide-able":!1,"background-color-class-name":"bg-red-500"},{icon:u((()=>[c(a,{icon:"folder"}),c(a,{icon:"minus",class:"absolute -ml-5 mt-2.5 text-xs text-gray-500"})])),_:1})])),_:1})),[[p,e.$t("storage.nav.button.removeFolder.label")]])}]]),RemoveFolderModal:ne,AddFolder:ce,UploadFile:ue,Settings:me,RemoveFiles:pe,TransferFiles:he,AddFolderModal:K,RemoveModal:le,SettingsModal:ie,UploadDialog:q,MoveFilesModal:P,ToggleLock:re},computed:{isAnyFileSelected:()=>0!=L().selectedFilesData.length,uploadExtraData(){return{uploadDir:this.$route.query.dir}}}},[["render",function(e,t,o,l,i,s){const a=d("TransferFiles"),u=d("RemoveFiles"),m=d("ToggleLock"),p=d("UploadFile"),h=d("RemoveFolder"),f=d("AddFolder"),g=d("Settings"),v=d("AddFolderModal"),M=d("RemoveFolderModal"),x=d("RemoveModal"),C=d("SettingsModal"),F=d("MoveFilesModal"),$=d("UploadDialog");return n(),r(b,null,[c(a,{class:"mb-96","is-disabled":!s.isAnyFileSelected,onClick:t[0]||(t[0]=e=>s.isAnyFileSelected?i.isMoveFilesModalVisible=!0:null)},null,8,["is-disabled"]),c(u,{class:"mb-82","is-disabled":!s.isAnyFileSelected,onClick:t[1]||(t[1]=e=>s.isAnyFileSelected?i.isRemoveModalVisible=!0:null)},null,8,["is-disabled"]),c(m,{class:"mb-62"}),c(p,{class:"mb-48",onClick:t[2]||(t[2]=e=>i.isUploadModalVisible=!0)}),c(h,{class:"mb-30",onClick:t[3]||(t[3]=e=>i.isRemoveFolderModalVisible=!0)}),c(f,{class:"mb-20",onClick:t[4]||(t[4]=e=>i.isAddFolderModalVisible=!0)}),c(g,{class:"mb-6",onClick:t[5]||(t[5]=e=>i.isSettingsModalVisible=!0)}),c(v,{"is-modal-visible":i.isAddFolderModalVisible,onModalClosed:t[6]||(t[6]=e=>i.isAddFolderModalVisible=!1)},null,8,["is-modal-visible"]),c(M,{"is-modal-visible":i.isRemoveFolderModalVisible,onModalClosed:t[7]||(t[7]=e=>i.isRemoveFolderModalVisible=!1)},null,8,["is-modal-visible"]),c(x,{"is-modal-visible":i.isRemoveModalVisible,onModalClosed:t[8]||(t[8]=e=>i.isRemoveModalVisible=!1)},null,8,["is-modal-visible"]),c(C,{"is-modal-visible":i.isSettingsModalVisible,onModalClosed:t[9]||(t[9]=e=>i.isSettingsModalVisible=!1)},null,8,["is-modal-visible"]),c(F,{"is-modal-visible":i.isMoveFilesModalVisible,onModalClosed:t[10]||(t[10]=e=>i.isMoveFilesModalVisible=!1)},null,8,["is-modal-visible"]),c($,{"is-visible":i.isUploadModalVisible,id:"storage-upload","configuration-id":i.uploadConfigId,"refresh-storage-state":!0,"extra-data":{uploadDir:e.$route.query.dir},onModalClosed:t[11]||(t[11]=e=>i.isUploadModalVisible=!1)},null,8,["is-visible","configuration-id","extra-data"])],64)}]]);const ge={data:()=>({storage:null}),props:{storageRouteName:{type:String,required:!0},nodes:{type:Object,required:!0},isRootNode:{type:Boolean,required:!1,default:!1},isOpen:{type:Boolean,required:!1,default:!1}},emits:["nodeCollapse","nodeOpen"],methods:{toggleAll(e){let t=Array.isArray(this.$refs.openCloseToggle)?this.$refs.openCloseToggle:[this.$refs.openCloseToggle];for(let o of t)e?this.openNode(o):this.closeNode(o)},toggleNode(e){let t=this.getTogglerParentList(e);if(!t)return;t.classList.toggle("h-0-force"),t.classList.toggle("overflow-hidden"),e.classList.toggle("node-open"),e.classList.toggle("node-collapsed");let o=null==e?void 0:e.getAttribute("data-node-path");t.classList.contains("h-0-force")?(this.$emit("nodeCollapse"),this.storage.removeOpenTreeNode(o)):(this.$emit("nodeOpen"),this.storage.addOpenTreeNode(o))},closeNode(e){let t=this.getTogglerParentList(e);if(!t)return;t.classList.add("h-0-force"),t.classList.add("overflow-hidden"),e.classList.add("node-collapsed"),e.classList.remove("node-open");let o=null==e?void 0:e.getAttribute("data-node-path");this.storage.removeOpenTreeNode(o)},openNode(e){let t=this.getTogglerParentList(e);if(!t)return;t.classList.remove("h-0-force"),t.classList.remove("overflow-hidden"),e.classList.remove("node-collapsed"),e.classList.add("node-open");let o=null==e?void 0:e.getAttribute("data-node-path");this.storage.addOpenTreeNode(o)},getTogglerParentList(e){if(e)return e.closest("li").querySelector(":scope ul")},isNodeActive(e){return this.$route.query.dir==e.path},setActiveNodeData(e){this.isNodeActive(e)&&(this.storage.activeNodeData=e)}},beforeMount(){this.storage=L()}},be=["data-node-path"],ve={key:1,class:"empty-toggle-node"},Me={class:"dir-name"},xe={data:()=>({trans:{toggleAll:{currentState:"storage.page.module.dirTree.toggleOpenClose.open",close:"storage.page.module.dirTree.toggleOpenClose.close",open:"storage.page.module.dirTree.toggleOpenClose.open"}}}),props:{dirsStructure:{type:Array,required:!0},routeName:{type:Array,required:!0}},components:{TreeNode:l(ge,[["render",function(e,t,o,l,i,s){const a=d("fa"),m=d("router-link"),h=d("TreeNode",!0);return n(),r("ul",{class:N(["node-level duration-400",{"root-node":o.isRootNode,"h-0-force overflow-hidden":!o.isRootNode&&!o.isOpen}]),ref:"nodeLevel"},[(n(!0),r(b,null,v(o.nodes,(l=>{var d,f,b,v,M;return n(),r("li",{key:JSON.stringify(l),class:"node-child"},[k(g(s.setActiveNodeData(l))+" ",1),0===(null==(d=l.children)?void 0:d.length)||o.isRootNode?o.isRootNode?S("",!0):(n(),r("span",ve)):(n(),r("span",{key:0,class:N(["open-close-toggle",{"node-open":o.isRootNode||(null==(f=i.storage)?void 0:f.isTreeNodeOpen(l.path)),"node-collapsed":!o.isRootNode&&!(null==(b=i.storage)?void 0:b.isTreeNodeOpen(l.path))}]),onClick:t[0]||(t[0]=e=>s.toggleNode(e.target)),ref_for:!0,ref:"openCloseToggle","data-node-path":l.path},null,10,be)),c(m,{to:{to:o.storageRouteName,query:{dir:l.path}}},{default:u((()=>[p("span",{class:N(["node-child-data",{"locked-node-child-data":l.isLocked}])},[s.isNodeActive(l)?(n(),y(a,{key:0,icon:"folder-open",class:N(["folder-icon",{"active-folder-tree-node":s.isNodeActive(l),"locked-node":l.isLocked}])},null,8,["class"])):(n(),y(a,{key:1,icon:"folder",class:"folder-icon"})),p("span",Me,g(l.dirname),1)],2)])),_:2},1032,["to"]),(null==(v=l.children)?void 0:v.length)>0?(n(),y(h,{key:2,nodes:l.children,"storage-route-name":o.storageRouteName,"is-open":o.isRootNode||(null==(M=i.storage)?void 0:M.isTreeNodeOpen(l.path)),ref_for:!0,ref:"treeNode",onNodeCollapse:t[1]||(t[1]=t=>e.$emit("nodeCollapse")),onNodeOpen:t[2]||(t[2]=t=>e.$emit("nodeOpen"))},null,8,["nodes","storage-route-name","is-open"])):S("",!0)])})),128))],2)}],["__scopeId","data-v-1ec873d0"]])},methods:{onNodeToggle(){let e=!!document.querySelector(".node-collapsed");this.trans.toggleAll.currentState=e?this.trans.toggleAll.open:this.trans.toggleAll.close},toggleAllClick(){let e=!!document.querySelector(".node-collapsed");this.trans.toggleAll.currentState=e?this.trans.toggleAll.close:this.trans.toggleAll.open,this.toggleAll(e)},findTreeNodeRefs(e,t=[]){var o;if(t.push(e),null==(o=e.$refs)?void 0:o.treeNode){let o=Array.isArray(e.$refs.treeNode)?e.$refs.treeNode:[e.$refs.treeNode];for(let e of o)t=this.findTreeNodeRefs(e,t)}return t},toggleAll(e){let t=this.findTreeNodeRefs(this.$refs.treeNode);for(let o of t)o.toggleAll(e)},openVisitedFolderNodes(){if(w.isEmptyString(this.$route.query.dir)||"/"===this.$route.query.dir)return;let e=this.$route.query.dir.split("/");if(0===e.length)return;let t="";for(let o of e)t+=w.isEmptyString(t)?o:`/${o}`,L().addOpenTreeNode(t)}},beforeMount(){this.openVisitedFolderNodes()},beforeUnmount(){L().clearOpenTreeNodes()}},Ce={class:"dirs-wrapper"},Fe={class:"w-full"},$e={key:0},ye={key:1,class:"flex flex-row flex-wrap"},ke={key:2,class:"flex justify-center flex-col w-full p-5 align-self-center h-full"},Ne={class:"flex justify-start flex-row flex-wrap -mt-5 mb-5"},Se={class:"text-lg text-left font-bold ml-2"},we={class:"self-end text-tiny ml-2 mb-0.5"},De={class:"flex justify-end mb-4"},Re={class:"flex flex-row h-full"},Ve=["innerHTML"];var Be=l({data:()=>({searchValue:""}),props:{dirsStructure:{type:Array,required:!0},folderContentClasses:{type:String,required:!1,default:"p-6"},routeName:{type:String,required:!0}},mixins:[e],emits:["visibleFilesChange"],components:{Container:V,FoldersTree:l(xe,[["render",function(e,t,o,l,i,s){const a=d("TreeNode");return n(),r("div",Ce,[p("p",{onClick:t[0]||(t[0]=(...e)=>s.toggleAllClick&&s.toggleAllClick(...e)),class:"cursor-pointer select-none hover:opacity-50"},g(e.$t(i.trans.toggleAll.currentState)),1),c(a,{nodes:o.dirsStructure,"storage-route-name":o.routeName,"is-root-node":!0,onNodeCollapse:s.onNodeToggle,onNodeOpen:s.onNodeToggle,ref:"treeNode"},null,8,["nodes","storage-route-name","onNodeCollapse","onNodeOpen"])])}],["__scopeId","data-v-9c5a5c5a"]]),FolderContent:l({props:{folderContentClasses:{type:String,required:!1},searchValue:{type:String,required:!0}},components:{NoResultsText:D},emits:["visibleFilesChange"],computed:{visibleFiles(){var e;let t=[];if(!(null==(e=this.nodeData)?void 0:e.files))return[];if(w.isEmptyString(this.searchValue))return this.$emit("visibleFilesChange",this.nodeData.files),this.nodeData.files;for(let o of this.nodeData.files)(o.name+(o.ext?`.${o.ext}`:"")).includes(this.searchValue)&&t.push(o);return this.$emit("visibleFilesChange",t),t},nodeData:()=>L().activeNodeData}},[["render",function(e,t,o,l,i,s){const a=d("NoResultsText");return n(),r("div",Fe,[s.visibleFiles.length>0?(n(),r("div",$e,[R(e.$slots,"description",{dirNodeData:s.nodeData})])):S("",!0),s.visibleFiles.length>0?(n(),r("div",ye,[(n(!0),r(b,null,v(s.visibleFiles,(t=>(n(),r("div",{key:JSON.stringify(t),class:N(o.folderContentClasses)},[R(e.$slots,"singleFile",{fileData:t,dirNodeData:s.nodeData})],2)))),128))])):(n(),r("div",ke,[c(a)]))])}]]),SideNav:fe,SearchInput:O},computed:{dirName(){var e;return null!=(e=this.$route.query.dir.split("/").reverse()[0])?e:""},activeNodeData:()=>L().activeNodeData},methods:{redirectToRootDir(){this.$nextTick((()=>{if(0===this.dirsStructure.length)return;let e=this.dirsStructure[0].path,t=null;for(let l of this.$route.matched)l.name===this.$route.name&&(t=l.path);let o=this.buildStorageUrl(e,t);document.querySelector(".active-folder-tree-node")||this.$router.push(o)}))}},beforeMount(){L().clearSelectedFiles()},updated(){L().clearSelectedFiles(),this.redirectToRootDir()},watch:{dirsStructure:{deep:!0,handler:function(){this.redirectToRootDir()}},"$route.query.dir"(){this.searchValue=""}}},[["render",function(e,t,o,l,i,s){const a=d("fa"),m=d("SearchInput"),h=d("FoldersTree"),f=d("FolderContent"),v=d("Container"),M=d("SideNav");return n(),r(b,null,[p("div",Ne,[p("span",Se,[k(" > "),s.activeNodeData.isLocked?(n(),y(a,{key:0,icon:"lock",class:"text-red-500"})):(n(),y(a,{key:1,icon:"lock-open",class:"text-green-500"})),k(" "+g(s.dirName),1)]),p("span",we," ("+g(e.$route.query.dir)+") ",1)]),p("div",De,[c(m,{modelValue:i.searchValue,"onUpdate:modelValue":t[0]||(t[0]=e=>i.searchValue=e)},null,8,["modelValue"])]),c(v,{"extra-classes":"folder-container"},{default:u((()=>[R(e.$slots,"containerBeginning"),p("div",Re,[c(h,{"dirs-structure":o.dirsStructure,"route-name":o.routeName,ref:"foldersTree"},null,8,["dirs-structure","route-name"]),c(f,{"folder-content-classes":o.folderContentClasses,"search-value":i.searchValue,onVisibleFilesChange:t[1]||(t[1]=t=>e.$emit("visibleFilesChange",t))},{description:u((({dirNodeData:e})=>[p("p",{class:"dir-description",innerHTML:e.description},null,8,Ve)])),singleFile:u((({fileData:t,dirNodeData:o})=>[R(e.$slots,"singleFile",{fileData:t,dirNodeData:o})])),_:3},8,["folder-content-classes","search-value"])])])),_:3}),c(M)],64)}]]);const Te={computed:{fileUrl(){return E.buildUrl(`${this.dirNodeData.path}/${this.fileData.name}.${this.fileData.ext}`)}}},Ae={data:()=>({name:"",tags:[],showModal:!1}),props:{isModalVisible:{type:Boolean,required:!0,default:!1},fileData:{type:Object,required:!0}},components:{MediumButtonWithIcon:i,Modal:s,TagInput:j,FormInput:m},mixins:[A,a],emits:["modalClosed","updateSuccess"],methods:{onModalClosed(){this.$emit("modalClosed")},onSubmit(){let e=this.fileData.name,t=this.name;this.fileData.ext&&(e+=`.${this.fileData.ext}`,t+=`.${this.fileData.ext}`);let o={currFileName:e,newFileName:t,dirPath:this.$route.query.dir,tags:this.tags},l=W.buildUrl(W.FILE_UPDATE_URL);this.$axios.post(l,o).then((e=>{this.handleResponse(e)&&(L().getAll(),this.$emit("modalClosed"))}))}},updated(){this.showModal=this.isModalVisible,this.tags=this.fileData.tags,this.name=this.fileData.name}},Le={class:"flex justify-center"},We={class:"w-full flex flex-col"},_e={data:()=>({textWrapperMaxWidth:"auto",isEditModalVisible:!1,isSelected:!1,filenameMaxLen:30}),props:{fileData:{type:Object,required:!0},dirNodeData:{type:Object,required:!0},moduleName:{type:String,required:!0},useImgWidthForTextWidth:{type:Boolean,required:!1,default:!1},selectOnFileRepresentationClick:{type:Boolean,required:!1,default:!0}},emits:["editClick"],mixins:[Te],components:{Checkbox:B,EditModal:l(Ae,[["render",function(e,t,o,l,i,s){const a=d("FormInput"),m=d("TagInput"),h=d("MediumButtonWithIcon"),f=d("Modal");return n(),r("div",null,[c(f,{"is-visible":i.showModal,id:"storage-file-edit",title:e.$t("storage.page.module.updateModal.header.label"),onModalClosed:s.onModalClosed,size:e.modalSize},{content:u((()=>[p("div",Le,[p("div",We,[c(a,{type:"text","is-required":!0,label:e.$t("storage.page.module.updateModal.form.name.label"),modelValue:i.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.name=e)},null,8,["label","modelValue"]),c(m,{modelValue:i.tags,"onUpdate:modelValue":t[1]||(t[1]=e=>i.tags=e)},null,8,["modelValue"]),c(h,{text:e.$t("storage.page.module.updateModal.form.submit.label"),"button-extra-classes":"pt-3 pb-3 sm:pt-1 sm:pb-1",class:"w-full mb-1 md:col-start-1 md:col-end-2 mt-6","button-classes":"w-full md:w-auto m-0-force","text-classes":"text-center w-full",onButtonClick:s.onSubmit},null,8,["text","onButtonClick"])])])])),_:1},8,["is-visible","title","onModalClosed","size"])])}]])},computed:{fileName(){let e=this.fileData.name;return this.fileData.ext&&(e+=`.${this.fileData.ext}`),e.length<=this.filenameMaxLen?e:e.substr(0,this.filenameMaxLen)+"..."},hoverContent(){let e='<div class="in-hover-tags">';for(let t of this.fileData.tags)e+=`<span class='in-hover-tag'>${t}</span>`;return e+="</div>",`\n        <div class="hover-content-wrapper">\n          <b>${this.$t("storage.fileHoverData.text.fileName")}</b>: ${this.fileData.name} ${this.fileData.ext?"."+this.fileData.ext:""}\n          <br><br>\n          <b>${this.$t("storage.fileHoverData.text.size")}</b>: ${this.fileData.size}\n          <br><br>\n          <b>${this.$t("storage.fileHoverData.text.tags")}</b><br>\n          ${e}\n        </div>\n      `}},methods:{setTextWrapperMaxWidth(){this.useImgWidthForTextWidth||(this.textWrapperMaxWidth="auto"),this.moduleName!==_[_.images]?this.textWrapperMaxWidth=`${this.$refs.fileRepresentation.offsetWidth}px`:this.textWrapperMaxWidth=`${getComputedStyle(this.$refs.fileRepresentation.querySelector("img")).width}`},copyLink(){z.copyToClipboard(this.fileUrl)}},mounted(){this.setTextWrapperMaxWidth()},watch:{isSelected(){this.isSelected?L().selectFile(this.fileData):L().deselectFile(this.fileData)}}},qe={class:"file-actions"},Ie=["href"],Ue=["href"];var Oe=l(_e,[["render",function(e,t,o,l,i,s){const a=d("Checkbox"),u=d("fa"),m=d("EditModal"),h=F("tippy");return n(),r("div",{class:N([{selected:i.isSelected},"file-base-main-wrapper"])},[p("div",null,[$((n(),r("div",{onClick:t[0]||(t[0]=t=>o.selectOnFileRepresentationClick?e.$refs.checkbox.toggle():null),class:"file-representation",ref:"fileRepresentation"},[R(e.$slots,"fileRepresentation")])),[[h,{content:s.hoverContent,position:"top",touch:!0}]]),p("div",{class:N(["file-name-wrapper",{[`file-name-wrapper-${o.moduleName}`]:!0}]),onClick:t[1]||(t[1]=t=>e.$refs.checkbox.toggle()),ref:"fileNameWrapper",style:T({"max-width":`${i.textWrapperMaxWidth} !important`})},g(s.fileName),7)]),p("div",qe,[$(c(a,{class:"transform scale-75",modelValue:i.isSelected,"onUpdate:modelValue":t[2]||(t[2]=e=>i.isSelected=e),ref:"checkbox"},null,8,["modelValue"]),[[h,e.$t("storage.nav.button.select.label")]]),p("a",{href:e.fileUrl,download:""},[$(c(u,{icon:"download",class:"text-lg cursor-pointer hover:opacity-70 download"},null,512),[[h,e.$t("storage.nav.button.download.label")]])],8,Ie),p("div",{href:e.fileUrl,onClick:t[3]||(t[3]=(...e)=>s.copyLink&&s.copyLink(...e))},[$(c(u,{icon:"link",class:"text-lg cursor-pointer hover:opacity-70"},null,512),[[h,e.$t("storage.nav.button.link.label")]])],8,Ue),$(c(u,{icon:"edit",class:"text-lg cursor-pointer hover:opacity-70 edit",onClick:t[4]||(t[4]=t=>{e.$emit("editClick"),i.isEditModalVisible=!0})},null,512),[[h,e.$t("storage.nav.button.edit.label")]])]),c(m,{"is-modal-visible":i.isEditModalVisible,"file-data":o.fileData,onModalClosed:t[5]||(t[5]=e=>i.isEditModalVisible=!1)},null,8,["is-modal-visible","file-data"])],2)}]]);export{Oe as F,Te as _,Be as a};
