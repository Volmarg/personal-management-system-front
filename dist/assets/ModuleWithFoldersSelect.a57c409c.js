import{b as e,a as t,S as l}from"./StorageState.ed0a31fa.js";import{_ as o}from"./ResponseHandlerMixin.2ac1b4b0.js";import{_ as s,aK as a,aF as r,r as i,o as n,e as d,f as h,Y as u,g as c}from"./index.96856189.js";const p={data:()=>({store:null,dirsStructure:[]}),mixins:[o],methods:{async getDirsStructure(e){this.store.moduleName=e,await this.store.getAll(),this.dirsStructure=this.store.allEntries},async addFolder(t,l){let o={parentDir:t,newDirName:l},s=e.buildUrl(e.FOLDER_CREATE_URL);return this.$axios.post(s,o).then((e=>this.handleResponse(e)))},async renameFolder(t,l){let o={currDirPath:t,newDirName:l},s=e.buildUrl(e.FOLDER_RENAME_URL);return this.$axios.post(s,o).then((e=>this.handleResponse(e)))},async moveOrCopyDir(t,l,o,s){let a={currDirPath:t,newDirParentPath:l,move:o,targetModuleName:s},r=e.buildUrl(e.FOLDER_MOVE_OR_COPY_URL);return this.$axios.post(r,a).then((e=>this.handleResponse(e)))}},beforeMount(){this.store=t()},watch:{"store.allEntries":{deep:!0,handler:function(){this.dirsStructure=this.store.allEntries}}}},m={class:"flex flex-wrap flex-col"},f={class:"w-full self-center"};var g=s({data:()=>({modulesStructure:{},folderPathOptions:[],categories:[],selectedModule:null,selectedFolderPath:null,isVisible:!0}),emits:["moduleSelectChange","folderSelectChange"],components:{MultiSelect:a},computed:{moduleOptions(){let e=[];for(let t of Object.keys(l).filter((e=>isNaN(e))))e.push({label:this.$t(`navbar.rightSidebar.menu.${t}.label`),selectedLabel:this.$t(`navbar.rightSidebar.menu.${t}.label`),value:t});return e}},methods:{getFolderLevel(e,t,l="",o=null){if(null===o&&(o=1),!l&&t.path===e)return o;let s=e.split("/"),a=[`${s[0]}/${s[1]}`];for(let r in s)0!=r&&1!=r&&a.push(s[r]);if(a=a.filter(Boolean),(l+=(1!=o?"/":"")+`${a[o-1]}`)===e)return o;if(t.path===e)return o;if(t.path===l)return o++,this.getFolderLevel(e,t,l,o);for(let r of t.children){if(r.path===e)return o;if(r.path===l)return o++,this.getFolderLevel(e,r,l,o)}throw new Error(`Could not find node with matching path: ${e}`)},traverseTree(){if(!this.selectedModule)return;let e=this.modulesStructure[this.selectedModule];for(let t of e)this.addOption(t,0),this.traverseNode(t)},traverseNode(e){if(e.children)for(let t of e.children){if(!this.folderPathOptions.find((e=>e.value==t.path))){let e=this.modulesStructure[this.selectedModule][0],l=this.getFolderLevel(t.path,e);this.addOption(t,l)}this.traverseNode(t)}},addOption(e,t){this.folderPathOptions.push({label:"ã…¤".repeat(t)+e.dirname,selectedLabel:e.dirname,value:e.path})},onModuleOptionChanged(e){this.selectedModule=e,this.$emit("moduleSelectChange",e)},onFolderOptionChanged(e){this.selectedFolderPath=e,this.$emit("folderSelectChange",e)},reload(){this.isVisible=!1,this.selectedModule=null,this.selectedFolderPath=null,this.$nextTick((async()=>{this.modulesStructure=await(new r).getAll(e.FOLDER_BASE_URL),this.traverseTree(),this.isVisible=!0}))}},mounted(){this.value=this.selected},async created(){this.modulesStructure=await(new r).getAll(e.FOLDER_BASE_URL),this.traverseTree()},watch:{selectedModule(){this.$refs.folderSelect.clear(),this.$nextTick((()=>{this.folderPathOptions=[],this.$emit("folderSelectChange",this.selectedFolderPath),this.traverseTree()}))}}},[["render",function(e,t,l,o,s,a){const r=i("MultiSelect");return n(),d("div",m,[h("div",f,[s.isVisible?(n(),u(r,{key:0,label:e.$t("storage.modulePathsSelect.label.modules"),"selected-label-source":"selectedLabel",options:a.moduleOptions,onChange:a.onModuleOptionChanged,onSelect:a.onModuleOptionChanged,onDeselect:a.onModuleOptionChanged,onClear:a.onModuleOptionChanged,onPaste:a.onModuleOptionChanged,modelValue:s.selectedModule,"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedModule=e),mode:"single","allow-show-options-list":!0,"allow-create-options":!1,"can-clear":!1,required:!0,class:"module-with-folder-select",ref:"moduleSelect"},null,8,["label","options","onChange","onSelect","onDeselect","onClear","onPaste","modelValue"])):c("",!0),s.isVisible?(n(),u(r,{key:1,label:e.$t("storage.modulePathsSelect.label.folderName"),"selected-label-source":"selectedLabel",options:s.folderPathOptions,onChange:a.onFolderOptionChanged,onSelect:a.onFolderOptionChanged,onDeselect:a.onFolderOptionChanged,onClear:a.onFolderOptionChanged,onPaste:a.onFolderOptionChanged,modelValue:s.selectedFolderPath,"onUpdate:modelValue":t[1]||(t[1]=e=>s.selectedFolderPath=e),mode:"single","allow-show-options-list":!0,"allow-create-options":!1,"can-clear":!1,required:!0,class:"mt-4 module-with-folder-select",ref:"folderSelect"},null,8,["label","options","onChange","onSelect","onDeselect","onClear","onPaste","modelValue"])):c("",!0)])])}]]);export{g as M,p as _};
