import{m as e,q as t,u as r,v as a,x as s,y as n,z as l,D as i,F as u,G as o,H as c,J as $,K as v,N as d}from"./index.daf34ba3.js";function p(e,t=[]){return Object.keys(e).reduce(((r,a)=>(t.includes(a)||(r[a]=v(e[a])),r)),{})}function h(e){return"function"==typeof e}function y(e,t,r){const a=v(t);return e.call(r,a,r)}function g(e){return void 0!==e.$valid?!e.$valid:!e}function f({validations:t,state:n,key:i,parentKey:u,childResults:o,resultsCache:c,globalConfig:$={},instance:m,externalResults:R}){const b=(E=function(){return T.value||K(),function(e,t,r){try{var a=Promise.resolve(e());return t?a.then(t):a}catch(s){return Promise.reject(s)}}(d,(function(){return new Promise((e=>{if(!z.value)return e(!A.value);const t=r(z,(()=>{e(!A.value),t()}))}))}))},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return Promise.resolve(E.apply(this,e))}catch(r){return Promise.reject(r)}});var E;const C=u?`${u}.${i}`:i,{rules:O,nestedValidators:j,config:x}=function(e={}){const t=v(e),r=Object.keys(t),a={},s={},n={};return r.forEach((e=>{const r=t[e];switch(!0){case h(r.$validator):a[e]=r;break;case h(r):a[e]={$validator:r};break;case e.startsWith("$"):n[e]=r;break;default:s[e]=r}})),{rules:a,nestedValidators:s,config:n}}(t),P=Object.assign({},$,x),w=i?l((()=>{const e=v(n);return e?v(e[i]):void 0})):n,L=Object.assign({},v(R)||{}),V=l((()=>{const e=v(R);return i?e?v(e[i]):void 0:e})),k=function(t,a,n,i,u,o,c,$){const d=Object.keys(t),f=i.get(u,t),m=e(!1);if(f){if(!f.$partial)return f;f.$unwatch(),m.value=f.$dirty.value}const R={$dirty:m,$path:u,$touch:()=>{m.value||(m.value=!0)},$reset:()=>{m.value&&(m.value=!1)}};return d.length?(d.forEach((s=>{R[s]=function(t,a,s,n,i,u,o,c){const $=e(!1),v=t.$params||{},d=e(null);let f,m;t.$async?({$invalid:f,$unwatch:m}=function(t,a,s,n,{$lazy:l},i,u,o=[]){const c=e(!!n.value),$=e(0);s.value=!1;const v=r([a,n].concat(o),(()=>{if(l&&!n.value)return!1;let e;try{e=y(t,a,u)}catch(r){e=Promise.reject(r)}$.value++,s.value=!!$.value,c.value=!1,Promise.resolve(e).then((e=>{$.value--,s.value=!!$.value,i.value=e,c.value=g(e)})).catch((e=>{$.value--,s.value=!!$.value,i.value=e,c.value=!0}))}),{immediate:!0,deep:"object"==typeof a});return{$invalid:c,$unwatch:v}}(t.$validator,a,$,s,n,d,i,t.$watchTargets)):({$invalid:f,$unwatch:m}=function(e,t,r,{$lazy:a},s,n){return{$unwatch:()=>({}),$invalid:l((()=>{if(a&&!r.value)return!1;try{const r=y(e,t,n);return s.value=r,g(r)}catch(l){s.value=l}return!0}))}}(t.$validator,a,s,n,d,i));const R=t.$message;return{$message:h(R)?l((()=>R(p({$pending:$,$invalid:f,$params:p(v),$model:a,$response:d,$validator:u,$propertyPath:c,$property:o})))):R||"",$params:v,$pending:$,$invalid:f,$response:d,$unwatch:m}}(t[s],a,R.$dirty,o,c,s,n,u)})),R.$externalResults=l((()=>$.value?[].concat($.value).map(((e,t)=>({$propertyPath:u,$property:n,$validator:"$externalResults",$uid:`${u}-externalResult-${t}`,$message:e,$params:{},$response:null,$pending:!1}))):[])),R.$invalid=l((()=>!!R.$externalResults.value.length||d.some((e=>v(R[e].$invalid))))),R.$pending=l((()=>d.some((e=>v(R[e].$pending))))),R.$error=l((()=>!!R.$dirty.value&&(R.$pending.value||R.$invalid.value))),R.$silentErrors=l((()=>d.filter((e=>v(R[e].$invalid))).map((e=>{const t=R[e];return s({$propertyPath:u,$property:n,$validator:e,$uid:`${u}-${e}`,$message:t.$message,$params:t.$params,$response:t.$response,$pending:t.$pending})})).concat(R.$externalResults.value))),R.$errors=l((()=>R.$dirty.value?R.$silentErrors.value:[])),R.$unwatch=()=>d.forEach((e=>{R[e].$unwatch()})),i.set(u,t,R),R):(f&&i.set(u,t,R),R)}(O,w,i,c,C,P,m,V),_=function(e,t,r,a,s,n,l){const i=Object.keys(e);return i.length?i.reduce(((i,u)=>(i[u]=f({validations:e[u],state:t,key:u,parentKey:r,resultsCache:a,globalConfig:s,instance:n,externalResults:l}),i)),{}):{}}(j,w,C,c,P,m,V),{$dirty:T,$errors:N,$invalid:A,$anyDirty:D,$error:F,$pending:z,$touch:K,$reset:S,$silentErrors:H}=function(e,t,r){const a=l((()=>[t,r].filter((e=>e)).reduce(((e,t)=>e.concat(Object.values(v(t)))),[]))),s=l({get:()=>e.$dirty.value||!!a.value.length&&a.value.every((e=>e.$dirty)),set(t){e.$dirty.value=t}}),n=l((()=>{const t=v(e.$silentErrors)||[],r=a.value.filter((e=>(v(e).$silentErrors||[]).length)).reduce(((e,t)=>e.concat(...t.$silentErrors)),[]);return t.concat(r)})),i=l((()=>{const t=v(e.$errors)||[],r=a.value.filter((e=>(v(e).$errors||[]).length)).reduce(((e,t)=>e.concat(...t.$errors)),[]);return t.concat(r)})),u=l((()=>a.value.some((e=>e.$invalid))||v(e.$invalid)||!1)),o=l((()=>a.value.some((e=>v(e.$pending)))||v(e.$pending)||!1)),c=l((()=>a.value.some((e=>e.$dirty))||a.value.some((e=>e.$anyDirty))||s.value)),$=l((()=>!!s.value&&(o.value||u.value))),d=()=>{e.$touch(),a.value.forEach((e=>{e.$touch()}))};return a.value.length&&a.value.every((e=>e.$dirty))&&d(),{$dirty:s,$errors:i,$invalid:u,$anyDirty:c,$error:$,$pending:o,$touch:d,$reset:()=>{e.$reset(),a.value.forEach((e=>{e.$reset()}))},$silentErrors:n}}(k,_,o),q=i?l({get:()=>v(w),set:e=>{T.value=!0;const t=v(n),r=v(R);r&&(r[i]=L[i]),a(t[i])?t[i].value=e:t[i]=e}}):null;return i&&P.$autoDirty&&r(w,(()=>{T.value||K();const e=v(R);e&&(e[i]=L[i])}),{flush:"sync"}),s(Object.assign({},k,{$model:q,$dirty:T,$error:F,$errors:N,$invalid:A,$anyDirty:D,$pending:z,$touch:K,$reset:S,$path:C||"__root",$silentErrors:H,$validate:b},o&&{$getResultsForChild:function(e){return(o.value||{})[e]},$clearExternalResults:function(){a(R)?R.value=L:0===Object.keys(L).length?Object.keys(R).forEach((e=>{delete R[e]})):Object.assign(R,L)}},_))}class m{constructor(){this.storage=new Map}set(e,t,r){this.storage.set(e,{rules:t,result:r})}checkRulesValidity(e,t,r){const a=Object.keys(r),s=Object.keys(t);return s.length===a.length&&(!!s.every((e=>a.includes(e)))&&s.every((e=>!t[e].$params||Object.keys(t[e].$params).every((a=>v(r[e].$params[a])===v(t[e].$params[a]))))))}get(e,t){const r=this.storage.get(e);if(!r)return;const{rules:a,result:s}=r,n=this.checkRulesValidity(e,t,a),l=s.$unwatch?s.$unwatch:()=>({});return n?s:{$dirty:s.$dirty,$partial:!0,$unwatch:l}}}const R=Symbol("vuelidate#injectChiildResults"),b=Symbol("vuelidate#removeChiildResults"),E={COLLECT_ALL:!0,COLLECT_NONE:!1};function C(d,p,y={}){1===arguments.length&&(y=d,d=void 0,p=void 0);let{$registerAs:g,$scope:C=E.COLLECT_ALL,$stopPropagation:O,$externalResults:j}=y;const x=$(),P=x?x.type:{};if(!g&&x){const e=x.uid||x._uid;g=`_vuelidate_${e}`}const w=e({}),L=new m,{childResults:V,sendValidationResultsToParent:k,removeValidationResultsFromParent:_}=x?function({$scope:t}){const r={},a=e([]),s=l((()=>a.value.reduce(((e,t)=>(e[t]=v(r[t]),e)),{}))),n=o(R,(()=>{}));c(R,(function(e,{$registerAs:s,$scope:n,$stopPropagation:l}){l||t===E.COLLECT_NONE||n===E.COLLECT_NONE||t!==E.COLLECT_ALL&&t!==n||(r[s]=e,a.value.push(s))}));const i=o(b,(()=>{}));return c(b,(function(e){a.value=a.value.filter((t=>t!==e)),delete r[e]})),{childResults:s,sendValidationResultsToParent:n,removeValidationResultsFromParent:i}}({$scope:C}):{childResults:e({})};if(!d&&P.validations){const a=P.validations;p=e({}),t((()=>{function e(t){return new Proxy(t,{get:(t,r,a)=>"object"==typeof t[r]?e(t[r]):l((()=>t[r]))})}p.value=x.proxy,r((()=>h(a)?a.call(p.value,new e(p.value)):a),(e=>{w.value=f({validations:e,state:p,childResults:V,resultsCache:L,globalConfig:y,instance:x.proxy,externalResults:j||x.proxy.vuelidateExternalResults})}),{immediate:!0})})),y=P.validationsConfig||y}else{const e=a(d)||i(T=d)||u(T)?d:s(d||{});r(e,(e=>{w.value=f({validations:e,state:p,childResults:V,resultsCache:L,globalConfig:y,instance:x?x.proxy:{},externalResults:j})}),{immediate:!0})}var T;return x&&(k(w,{$registerAs:g,$scope:C,$stopPropagation:O}),n((()=>_(g)))),l((()=>Object.assign({},v(w.value),V.value)))}const O={name:"VuelidateHandler",data:()=>({isVuelidateResultValid:!1}),methods:{validateValue(e,t){var r;const a=C(t,e,{currentVueInstance:null==(r=$())?void 0:r.proxy});let s=[];for(let n of a.value.$silentErrors)s.push(String(n.$message));return s},vuelidateErrorsToPropsViolation(e){let t={};if(0===e.length)return this.isVuelidateResultValid=!0,{};for(let r of e)void 0===t[r.$property]?t[r.$property]=[r.$message]:t[r.$property].push(r.$message);return this.isVuelidateResultValid=!1,t}}};export{O as _,C as u};
