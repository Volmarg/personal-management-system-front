import{_ as e,r as t,o as a,e as l,f as s,t as n,h as o,g as r,aS as i,Y as d,M as m,aI as u,I as p,aW as c,B as h,k as y,aE as f,aF as b,c as P,af as v,aa as C,j as Y}from"./index.93e753e6.js";import{A as S,a as x,B as w}from"./Base.88a7709f.js";import{Y as A}from"./YearSelect.a9826e3f.js";import{S as I}from"./SimpleTable.2176e307.js";import{T as V}from"./PaymentTypeSelect.0a8d4562.js";import{S as g}from"./SymfonyPaymentsRoutes.8ab93abb.js";import{T as F}from"./TableActions.b19e3a52.js";import"./BrowserDetection.6a5570eb.js";import"./ColorBorderBar.99bb35e7.js";import"./SearchInput.c3a3a680.js";import"./ClipboardService.32914954.js";const M={key:0,class:"flex flex-col justify-end"},j={class:"text-lg text-center md:text-right pr-0 md:pr-6 mb-1"},T={class:"w-full flex justify-end"},$={class:"w-full md:w-1/2 lg:w-1/3 xl:w-1/6"};var B=e({data:()=>({selectedYear:null}),props:{preselectedYear:{type:[String,null],required:!1,default:null},data:{type:Object,required:!0}},emits:["yearFilterChange"],components:{YearSelect:A},computed:{years(){return Object.keys(this.data)}},beforeMount(){this.selectedYear=this.preselectedYear},watch:{selectedYear(){this.$emit("yearFilterChange",this.selectedYear)},preselectedYear(){this.selectedYear=this.preselectedYear}}},[["render",function(e,i,d,m,u,p){const c=t("YearSelect");return p.years.length>0?(a(),l("div",M,[s("div",null,[s("h2",j,n(e.$t("payments.monthly.filter.label")),1)]),s("div",T,[s("div",$,[o(c,{years:p.years,"allow-all-option":!0,modelValue:u.selectedYear,"onUpdate:modelValue":i[0]||(i[0]=e=>u.selectedYear=e)},null,8,["years","modelValue"])])])])):r("",!0)}]]),N=e({data(){return{allYears:[],yearFilter:null,headers:[{label:"id",dataValuePath:"id.value",isVisible:!1,dataIsComponentPath:null,dataComponentPropertiesPath:null},{label:"typeId",dataValuePath:"typeId.value",isVisible:!1,dataIsComponentPath:null,dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.date.label"),dataValuePath:"date.value",dataIsComponentPath:"date.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.money.label"),dataValuePath:"money.value",dataIsComponentPath:"money.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.description.label"),dataValuePath:"description.value",dataIsComponentPath:"description.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.type.label"),dataValuePath:"typeName.value",dataIsComponentPath:"typeName.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.actions.label"),dataValuePath:"actions.value",dataIsComponentPath:"actions.isComponent",dataComponentPropertiesPath:"actions.componentProps"}]}},props:{data:{type:Array,required:!0}},components:{NoResultsText:i,SimpleTable:I},computed:{usedData(){let e=[];for(let t of this.data)this.yearFilter&&t.values.year.value!=this.yearFilter||e.push(t);return e}}},[["render",function(e,l,s,n,o,r){const i=t("SimpleTable"),m=t("NoResultsText");return s.data.length>0?(a(),d(i,{key:0,headers:o.headers,data:r.usedData,ref:"table",class:"mt-4"},null,8,["headers","data"])):(a(),d(m,{key:1}))}]]);const k={class:"flex justify-center"},_={class:"mt-6 md:w-1/2 lg:w-1/3 w-full flex flex-col"},q={class:"text-lg"};var E=e({data:()=>({form:{date:null,money:null,description:null,typeId:null}}),props:{id:{type:[Number,null],required:!1,default:null},date:{type:[String,null],required:!1,default:null},money:{type:[Number,null],required:!1,default:null},description:{type:[String,null],required:!1,default:null},typeId:{type:[Number,null],required:!1,default:null}},components:{MediumButtonWithIcon:m,Container:u,FormInput:p,TypeSelect:V},methods:{clearForm(){this.form.typeId=null,this.form.date=null,this.form.description=null,this.form.money=null},async onSubmit(){let e,t=new c(g.MONTHLY_BASE_URL,this.id,h,this.form);t.reload=!1,e=this.id?await this.$moduleCall.update(t):await this.$moduleCall.new(t),e.success&&(this.$emit("submit"),this.clearForm())}},beforeMount(){this.form.typeId=this.typeId,this.form.date=this.date,this.form.description=this.description,this.form.money=this.money}},[["render",function(e,l,r,i,m,u){const p=t("FormInput"),c=t("TypeSelect"),h=t("MediumButtonWithIcon"),f=t("Container");return a(),d(f,null,{default:y((()=>[s("div",k,[s("div",_,[s("h2",q,n(e.$t("payments.monthly.newForm.header")),1),o(p,{type:"date",modelValue:m.form.date,"onUpdate:modelValue":l[0]||(l[0]=e=>m.form.date=e),"is-required":!0,label:e.$t("payments.monthly.newForm.date.label")},null,8,["modelValue","label"]),o(p,{type:"number",modelValue:m.form.money,"onUpdate:modelValue":l[1]||(l[1]=e=>m.form.money=e),"is-required":!0,label:e.$t("payments.monthly.newForm.money.label")},null,8,["modelValue","label"]),o(p,{type:"text",modelValue:m.form.description,"onUpdate:modelValue":l[2]||(l[2]=e=>m.form.description=e),"is-required":!0,label:e.$t("payments.monthly.newForm.description.label")},null,8,["modelValue","label"]),o(c,{modelValue:m.form.typeId,"onUpdate:modelValue":l[3]||(l[3]=e=>m.form.typeId=e)},null,8,["modelValue"]),o(h,{text:e.$t("payments.monthly.newForm.submit.label"),"button-extra-classes":"pt-3 pb-3 sm:pt-1 sm:pb-1",class:"w-full mb-1 md:col-start-1 md:col-end-2 mt-6","button-classes":"w-full md:w-auto m-0-force","text-classes":"text-center w-full",onButtonClick:u.onSubmit},null,8,["text","onButtonClick"])])])])),_:1})}]]);const D=f("paymentMonthlyState",{state:()=>({allEntries:[]}),actions:{async getAll(){this.allEntries=await(new b).getAll(g.MONTHLY_BASE_URL)}}}),U={class:"mt-4 flex justify-center"},O={key:0,class:"mt-2"},L={class:"font-bold"};var R=e({data:()=>({form:{date:null,money:null,description:null,type:null},selectedYear:null,store:null,allPayments:[]}),components:{Accordion:S,AccordionPanel:x,Base:w,Navbar:B,PaymentsTable:N,Container:u,AddEditForm:E},computed:{paymentsData(){let e=[];for(let t of this.allPayments)e.push({values:{id:{value:t.id,isComponent:!1},date:{value:t.date,isComponent:!1},money:{value:t.money,isComponent:!1},description:{value:t.description,isComponent:!1},typeName:{value:t.typeName,isComponent:!1},typeId:{value:t.typeId,isComponent:!1},actions:{value:F,isComponent:!0,componentProps:{editActionForm:E,baseUrl:g.MONTHLY_BASE_URL,store:D}}}});return e},accordionsData(){if(!this.selectedYear){let e={};for(let t in this.dataPerYearsAndMonths)e={...e,...this.dataPerYearsAndMonths[t]};return e}return this.dataPerYearsAndMonths[this.selectedYear]},dataPerYearsAndMonths(){let e={};for(let t of this.paymentsData){let a=t.values.date.value.match(/[0-9]{4}/),l=t.values.date.value.match(/[0-9]{4}-[0-9]{2}/);e[a]||(e[a]={}),e[a][l]||(e[a][l]=[]),e[a][l].push(t)}return e}},methods:{paymentSummaryData(e){let t={},a=0,l=e.match(/[0-9]{4}/);for(let s of this.dataPerYearsAndMonths[l][e]){let e=P.ucFirst(s.values.typeName.value);t[e]||(t[e]=0),t[e]+=s.values.money.value,a+=s.values.money.value}t[this.$t("payments.monthly.text.summary")]=a;for(let s in t){let e=t[s];t[s]=e.toFixed(2)}return t},paymentTotal(e){let t=0,a=e.match(/[0-9]{4}/);for(let l of this.dataPerYearsAndMonths[a][e])t+=l.values.money.value;return t.toFixed(2)},async refreshPageState(){await this.store.getAll(),this.allPayments=this.store.allEntries,this.selectedYear=Math.max(...Object.keys(this.dataPerYearsAndMonths).sort())}},async beforeMount(){this.store=D(),await this.refreshPageState()},watch:{"store.allEntries":{deep:!0,handler:function(){this.allPayments=this.store.allEntries,this.selectedYear=Math.max(...Object.keys(this.dataPerYearsAndMonths).sort())}}}},[["render",function(e,i,m,u,p,c){const h=t("Navbar"),f=t("PaymentsTable"),b=t("Container"),P=t("AccordionPanel"),S=t("Accordion"),x=t("AddEditForm"),w=t("Base");return a(),d(w,{"info-block-description":e.$t("payments.monthly.description"),"is-in-container":!1},{default:y((()=>[o(h,{data:c.dataPerYearsAndMonths,"preselected-year":p.selectedYear,onYearFilterChange:i[0]||(i[0]=e=>p.selectedYear=e),class:"mb-6"},null,8,["data","preselected-year"]),(a(!0),l(C,null,v(c.accordionsData,((t,i)=>(a(),d(S,{key:i},{default:y((()=>[o(P,{class:"accordion-panel"},{title:y((()=>[Y(n(i)+" ("+n(c.paymentTotal(i))+")",1)])),content:y((()=>[o(b,{class:"mb-6"},{default:y((()=>[o(f,{data:t},null,8,["data"]),s("div",U,[s("ul",null,[(a(!0),l(C,null,v(c.paymentSummaryData(i),((t,o)=>(a(),l("li",{key:o,class:"text-lg text-right"},[o===e.$t("payments.monthly.text.summary")?(a(),l("hr",O)):r("",!0),s("span",L,n(o)+": ",1),s("span",null,n(t),1)])))),128))])])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),o(x,{onSubmit:c.refreshPageState},null,8,["onSubmit"])])),_:1},8,["info-block-description"])}]]);export{R as default};
