import{_ as e,aK as t,r as i,o as s,Y as n,ab as r,I as o,R as a,e as l,aa as d,af as u,k as c,W as h,f as p,n as f,t as m,g,h as v,X as y,w as b,aL as w,B as x,E,S as k,M as S,aI as F,T as C,d as I,p as O,l as N,a0 as T,Q as A,a1 as $}from"./index.93e753e6.js";import{C as M}from"./ColorBorderBar.99bb35e7.js";import{S as j}from"./SymfonyFileRoutes.22a19209.js";import{a as _}from"./StorageState.9670e54c.js";var U=e({data:()=>({selectedValue:[]}),props:{modelValue:{required:!1},isDisabled:{type:Boolean,required:!1,default:!1}},components:{MultiSelect:t},methods:{onOptionChanged(e){this.selectedValue=e,this.$emit("update:modelValue",e)}},mounted(){this.$nextTick((()=>{this.selectedValue=this.modelValue}))},watch:{modelValue(){this.$nextTick((()=>{this.selectedValue=this.modelValue}))}}},[["render",function(e,t,r,o,a,l){const d=i("MultiSelect");return s(),n(d,{label:e.$t("generic.tags.label"),disabled:r.isDisabled,onChange:l.onOptionChanged,onSelect:l.onOptionChanged,onDeselect:l.onOptionChanged,onClear:l.onOptionChanged,onPaste:l.onOptionChanged,modelValue:a.selectedValue,"onUpdate:modelValue":t[0]||(t[0]=e=>a.selectedValue=e),mode:"tags","max-options":"20","allow-show-options-list":!1,"allow-create-options":!0},null,8,["label","disabled","onChange","onSelect","onDeselect","onClear","onPaste","modelValue"])}]]);const z={data:()=>({uploadStatus:{success:"success",error:"error",malicious:"malicious"}})},D={class:"file-info"},P={key:0,class:"extra"},V={class:"upload-status"},B={key:0},R={key:1},L={key:2},H={class:"actions"},q={key:0};var J=e({data:()=>({fileNames:{},tags:[]}),props:{files:{type:Array,required:!0},configuration:{type:Object,required:!0}},mixins:[z],components:{ColorBorderBar:M,TagInput:U,la:r,"v-input":o},computed:{isExtraSectionActive(){return this.configuration.allowNaming||this.configuration.allowTagging}},methods:{isMalicious(e){return e===this.uploadStatus.malicious},isSuccess(e){return e===this.uploadStatus.success},isFailure(e){return e===this.uploadStatus.error},bytesToMb:e=>(e/1024/1024).toFixed(2),onFileNameInput(e){e.userDefinedName=this.fileNames[e.id]},onTagInput(e,t){e.tags=t}},emits:["removeFile"]},[["render",function(e,t,r,o,w,x){const E=i("v-input"),k=i("TagInput"),S=i("la"),F=i("ColorBorderBar"),C=a("tippy");return s(),l("div",null,[(s(!0),l(d,null,u(r.files,(i=>(s(),n(F,{key:i.id,class:"single-uploaded-file"},{default:c((()=>[h(e.$slots,"default",{},(()=>[p("div",{class:f(["flex md:flex-row justify-between w-full flex-col",{"items-center":x.isExtraSectionActive}])},[p("div",D,[p("p",null,m(i.name),1),p("p",null," ("+m(x.bytesToMb(i.size))+" Mb) ",1)]),x.isExtraSectionActive?(s(),l("div",P,[r.configuration.allowNaming?(s(),n(E,{key:0,label:e.$t("generic.form.upload.field.fileName.label"),type:"text",class:"mt-6 ml-2 w-full lg:w-2/5",ref_for:!0,ref:"userDefinedName"+i.id,onInput:e=>x.onFileNameInput(i),modelValue:w.fileNames[i.id],"onUpdate:modelValue":e=>w.fileNames[i.id]=e,"is-disabled":i.uploadHandled},null,8,["label","onInput","modelValue","onUpdate:modelValue","is-disabled"])):g("",!0),v(k,{modelValue:w.tags,"onUpdate:modelValue":[t[0]||(t[0]=e=>w.tags=e),e=>x.onTagInput(i,e)],"is-disabled":i.uploadHandled,class:"w-full lg:w-3/5 self-center lg:mr-4 ml-4"},null,8,["modelValue","onUpdate:modelValue","is-disabled"])])):g("",!0),p("div",V,[x.isMalicious(i.status)?(s(),l("span",B,[y(v(S,{"svg-icon-name":"bug-solid","font-size":30,color:"red"},null,512),[[C,{content:e.$t("generic.form.upload.status.malicious.label")}]])])):x.isFailure(i.status)?(s(),l("span",R,[y(v(S,{"svg-icon-name":"times-circle-solid","font-size":30,color:"red"},null,512),[[C,{content:e.$t("generic.form.upload.status.error.label")}]])])):x.isSuccess(i.status)?(s(),l("span",L,[y(v(S,{"svg-icon-name":"check-circle-solid","font-size":30,color:"green"},null,512),[[C,{content:e.$t("generic.form.upload.status.success.label")}]])])):g("",!0)]),p("div",H,[i.success?g("",!0):(s(),l("div",q,[y(v(S,{"svg-icon-name":"trash-alt","font-size":30,color:"red",class:"hover:opacity-50 cursor-pointer",onClick:b((t=>e.$emit("removeFile",i)),["prevent"])},null,8,["onClick"]),[[C,{content:e.$t("generic.form.upload.actions.remove.label")}]])]))])],2)]),!0)])),_:2},1024)))),128))])}],["__scopeId","data-v-7829d818"]]);const X=e=>{const t=new XMLHttpRequest;return t.open(e.method||"GET",e.url),t.responseType="json",e.headers&&Object.keys(e.headers).forEach((i=>{t.setRequestHeader(i,e.headers[i])})),t};function G(e){return t=X(e),i=e.body,new Promise(((e,s)=>{t.onload=()=>{if(t.status>=200&&t.status<300){let s;try{s=JSON.parse(t.response)}catch(i){s=t.response}e(s)}else s(t.response)},t.onerror=()=>s(t.response),t.send(JSON.stringify(i))}));var t,i}const W={headers:{},action:"",minSize:1048576,maxActive:3,maxRetries:5,handler:class{constructor(e,t){this.file=e,this.options=t,this.chunks=[],this.sessionId=null,this.chunkSize=null,this.speedInterval=null}get maxRetries(){return parseInt(this.options.maxRetries,10)}get maxActiveChunks(){return parseInt(this.options.maxActive,10)}get fileType(){return this.file.type}get fileSize(){return this.file.size}get fileName(){return this.file.name}get action(){return this.options.action||null}get startBody(){return this.options.startBody||{}}get uploadBody(){return this.options.uploadBody||{}}get finishBody(){return this.options.finishBody||{}}get headers(){return this.options.headers||{}}get readyToUpload(){return!!this.chunks}get progress(){const e=this.chunksUploaded.length/this.chunks.length*100,t=this.chunksUploading.reduce(((e,t)=>e+(0|t.progress)/this.chunks.length),0);return Math.min(e+t,100)}get chunksToUpload(){return this.chunks.filter((e=>!e.active&&!e.uploaded))}get hasChunksToUpload(){return this.chunksToUpload.length>0}get chunksUploading(){return this.chunks.filter((e=>!!e.xhr&&!!e.active))}get chunksUploaded(){return this.chunks.filter((e=>!!e.uploaded))}createChunks(){this.chunks=[];let e=0,t=this.chunkSize;for(;e<this.fileSize;)this.chunks.push({blob:this.file.file.slice(e,t),startOffset:e,active:!1,retries:this.maxRetries}),e=t,t=e+this.chunkSize}updateFileProgress(){this.file.progress=this.progress}pause(){this.file.active=!1,this.stopChunks()}stopChunks(){this.chunksUploading.forEach((e=>{e.xhr.abort(),e.active=!1})),this.stopSpeedCalc()}resume(){this.file.active=!0,this.startChunking()}upload(){return this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t})),this.start(),this.promise}start(){G({method:"POST",headers:{...this.headers,"Content-Type":"application/json"},url:this.action,body:Object.assign(this.startBody,{phase:"start",mime_type:this.fileType,size:this.fileSize,name:this.fileName})}).then((e=>{if("success"!==e.status)return this.file.response=e,this.reject("server");this.sessionId=e.data.session_id,this.chunkSize=e.data.end_offset,this.createChunks(),this.startChunking()})).catch((e=>{this.file.response=e,this.reject("server")}))}startChunking(){for(let e=0;e<this.maxActiveChunks;e++)this.uploadNextChunk();this.startSpeedCalc()}uploadNextChunk(){if(this.file.active){if(this.hasChunksToUpload)return this.uploadChunk(this.chunksToUpload[0]);if(0===this.chunksUploading.length)return this.finish()}}uploadChunk(e){e.progress=0,e.active=!0,this.updateFileProgress(),e.xhr=X({method:"POST",headers:this.headers,url:this.action}),e.xhr.upload.addEventListener("progress",(function(t){t.lengthComputable&&(e.progress=Math.round(t.loaded/t.total*100))}),!1),((e,t)=>{const i=new FormData;for(let s in t)i.append(s,t[s]);return new Promise(((t,s)=>{e.onload=()=>{if(e.status>=200&&e.status<300){let s;try{s=JSON.parse(e.response)}catch(i){s=e.response}t(s)}else s(e.response)},e.onerror=()=>s(e.response),e.send(i)}))})(e.xhr,Object.assign(this.uploadBody,{phase:"upload",session_id:this.sessionId,start_offset:e.startOffset,chunk:e.blob})).then((t=>{if(e.active=!1,"success"===t.status)e.uploaded=!0;else if(e.retries--<=0)return this.stopChunks(),this.reject("upload");this.uploadNextChunk()})).catch((()=>{if(e.active=!1,e.retries--<=0)return this.stopChunks(),this.reject("upload");this.uploadNextChunk()}))}finish(){this.updateFileProgress(),this.stopSpeedCalc(),G({method:"POST",headers:{...this.headers,"Content-Type":"application/json"},url:this.action,body:Object.assign(this.finishBody,{phase:"finish",session_id:this.sessionId})}).then((e=>{if(this.file.response=e,"success"!==e.status)return this.reject("server");this.resolve(e)})).catch((e=>{this.file.response=e,this.reject("server")}))}startSpeedCalc(){this.file.speed=0;let e=0;this.speedInterval||(this.speedInterval=window.setInterval((()=>{let t=this.progress/100*this.fileSize;this.file.speed=t-e,e=t}),1e3))}stopSpeedCalc(){this.speedInterval&&window.clearInterval(this.speedInterval),this.speedInterval=null,this.file.speed=0}}},Y=w({props:{inputId:{type:String},name:{type:String,default:"file"},accept:{type:String},capture:{},disabled:{default:!1},multiple:{type:Boolean,default:!1},maximum:{type:Number},addIndex:{type:[Boolean,Number]},directory:{type:Boolean},createDirectory:{type:Boolean,default:!1},postAction:{type:String},putAction:{type:String},customAction:{type:Function},headers:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})},timeout:{type:Number,default:0},drop:{default:!1},dropDirectory:{type:Boolean,default:!0},size:{type:Number,default:0},extensions:{type:[RegExp,String,Array],default:()=>[]},modelValue:{type:Array,default:()=>[]},thread:{type:Number,default:1},chunkEnabled:{type:Boolean,default:!1},chunk:{type:Object,default:()=>W}},emits:["update:modelValue","input-filter","input-file"],data(){return{files:this.modelValue,features:{html5:!0,directory:!1,drop:!1},active:!1,dropActive:!1,uploading:0,destroy:!1,maps:{},dropElement:null,reload:!1}},mounted(){const e=document.createElement("input");if(e.type="file",e.multiple=!0,window.FormData&&e.files?("boolean"!=typeof e.webkitdirectory&&"boolean"!=typeof e.directory||(this.features.directory=!0),this.features.html5&&void 0!==e.ondrop&&(this.features.drop=!0)):this.features.html5=!1,this.maps={},this.files)for(let t=0;t<this.files.length;t++){const e=this.files[t];this.maps[e.id]=e}this.$nextTick((()=>{this.$parent?(this.$parent.$forceUpdate(),this.$parent.$nextTick((()=>{this.watchDrop(this.drop)}))):this.watchDrop(this.drop)}))},beforeUnmount(){this.destroy=!0,this.active=!1,this.watchDrop(!1),this.watchActive(!1)},computed:{uploaded(){let e;for(let t=0;t<this.files.length;t++)if(e=this.files[t],e.fileObject&&!e.error&&!e.success)return!1;return!0},chunkOptions(){return Object.assign(W,this.chunk)},className(){return["file-uploads",this.features.html5?"file-uploads-html5":"file-uploads-html4",this.features.directory&&this.directory?"file-uploads-directory":void 0,this.features.drop&&this.drop?"file-uploads-drop":void 0,this.disabled?"file-uploads-disabled":void 0]},forId(){return this.inputId||this.name},iMaximum(){return void 0===this.maximum?this.multiple?0:1:this.maximum},iExtensions(){if(!this.extensions)return;if(this.extensions instanceof RegExp)return this.extensions;if(!this.extensions.length)return;let e=[];return e="string"==typeof this.extensions?this.extensions.split(","):this.extensions,e=e.map((function(e){return e.trim()})).filter((function(e){return e})),new RegExp("\\.("+e.join("|").replace(/\./g,"\\.")+")$","i")}},watch:{active(e){this.watchActive(e)},dropActive(){this.$parent&&this.$parent.$forceUpdate()},drop(e){this.watchDrop(e)},modelValue(e){if(this.files===e)return;this.files=e;const t=this.maps;this.maps={};for(let i=0;i<this.files.length;i++){const e=this.files[i];this.maps[e.id]=e}for(const i in this.maps){const e=this.maps[i],s=t[i];e!==s&&this.emitFile(e,s)}for(const i in t)this.maps[i]||this.emitFile(void 0,t[i])}},methods:{newId:()=>Math.random().toString(36).substr(2),clear(){if(this.files.length){const e=this.files;this.files=[],this.maps={},this.emitInput();for(let t=0;t<e.length;t++)this.emitFile(void 0,e[t])}return!0},get(e){return!!e&&("object"==typeof e?this.maps[e.id||""]||!1:this.maps[e]||!1)},add(e,t){let i;i=e instanceof Array?e:[e],void 0===t&&(t=this.addIndex);let s,n=[];for(let o=0;o<i.length;o++){let e=i[o];this.features.html5&&e instanceof Blob&&(e={id:"",file:e,size:e.size,name:e.webkitRelativePath||e.relativePath||e.name||"unknown",type:e.type});let t=!1;if(!1===e.fileObject||(e.fileObject||"undefined"!=typeof Element&&e.el instanceof HTMLInputElement||"undefined"!=typeof Blob&&e.file instanceof Blob)&&(t=!0),t&&(e={fileObject:!0,size:-1,name:"Filename",type:"",active:!1,error:"",success:!1,putAction:this.putAction,postAction:this.postAction,timeout:this.timeout,...e,response:{},progress:"0.00",speed:0},e.data={...this.data,...e.data?e.data:{}},e.headers={...this.headers,...e.headers?e.headers:{}}),e.id||(e.id=this.newId()),!this.emitFilter(e,void 0)){if(this.iMaximum>1&&n.length+this.files.length>=this.iMaximum)break;if(n.push(e),1===this.iMaximum)break}}if(!n.length)return;1===this.iMaximum&&this.clear(),!0===t||0===t?s=n.concat(this.files):t?(s=this.files.concat([]),s.splice(t,0,...n)):s=this.files.concat(n),this.files=s;let r=0;!0===t||0===t?r=0:t?t>=0?r=t+n.length>this.files.length?this.files.length-n.length:t:(r=this.files.length-n.length+t,r<0&&(r=0)):r=this.files.length-n.length,n=this.files.slice(r,r+n.length);for(let o=0;o<n.length;o++){const e=n[o];this.maps[e.id]=e}this.emitInput();for(let o=0;o<n.length;o++)this.emitFile(n[o],void 0);return e instanceof Array?n:n[0]},addInputFile(e){const t=[];this.iMaximum;const i=e.webkitEntries||e.entries||void 0;if(null==i?void 0:i.length)return this.getFileSystemEntry(i).then((e=>this.add(e)));if(e.files)for(let s=0;s<e.files.length;s++){const i=e.files[s];t.push({id:"",size:i.size,name:i.webkitRelativePath||i.relativePath||i.name,type:i.type,file:i})}else{let i=e.value.replace(/\\/g,"/").split("/");i&&i.length||(i=[e.value]),delete e.__vuex__,t.push({id:"",name:i[i.length-1],el:e})}return Promise.resolve(this.add(t))},addDataTransfer(e){var t;if(null==(t=null==e?void 0:e.items)?void 0:t.length){const t=[];for(let i=0;i<e.items.length;i++){const s=e.items[i];let n;n=s.getAsEntry?s.getAsEntry()||s.getAsFile():s.webkitGetAsEntry&&s.webkitGetAsEntry()||s.getAsFile(),n&&t.push(n)}return this.getFileSystemEntry(t).then((e=>this.add(e)))}const i=this.iMaximum,s=[];if(e.files.length){for(let t=0;t<e.files.length&&(s.push(e.files[t]),!(i>0&&s.length>=i));t++);return Promise.resolve(this.add(s))}return Promise.resolve([])},getFileSystemEntry(e,t=""){return new Promise((i=>{const s=this.iMaximum;if(e)if(e instanceof Array){const n=[],r=o=>{const a=e[o];if(!a||s>0&&n.length>=s)return i(n);this.getFileSystemEntry(a,t).then((function(e){n.push(...e),r(o+1)}))};r(0)}else if(e instanceof Blob)i([{id:"",size:e.size,name:t+e.name,type:e.type,file:e}]);else if(e.isFile)e.file((function(e){i([{id:"",size:e.size,name:t+e.name,type:e.type,file:e}])}));else if(e.isDirectory&&this.dropDirectory){let n=e;const r=[];this.createDirectory&&r.push({id:"",name:t+n.name,size:0,type:"text/directory",file:new File([],t+n.name,{type:"text/directory"})});const o=n.createReader(),a=()=>{o.readEntries((e=>{const o=l=>!e[l]&&0===l||s>0&&r.length>=s?i(r):e[l]?void this.getFileSystemEntry(e[l],t+n.name+"/").then((function(e){r.push(...e),o(l+1)})):a();o(0)}))};a()}else i([]);else i([])}))},replace(e,t){const i=this.get(e),s=this.get(t);if(!i||!s||i===s)return!1;const n=this.files.concat([]),r=n.indexOf(i),o=n.indexOf(s);return-1!==r&&-1!==o&&(n[r]=s,n[o]=i,this.files=n,this.emitInput(),!0)},remove(e){const t=this.get(e);if(t){if(this.emitFilter(void 0,t))return!1;const e=this.files.concat([]),i=e.indexOf(t);if(-1===i)return console.error("remove",t),!1;e.splice(i,1),this.files=e,delete this.maps[t.id],this.emitInput(),this.emitFile(void 0,t)}return t},update(e,t){const i=this.get(e);if(i){let e={...i,...t};if(!i.fileObject||!i.active||e.active||e.error||e.success||(e.error="abort"),this.emitFilter(e,i))return!1;const s=this.files.concat([]),n=s.indexOf(i);return-1===n?(console.error("update",i),!1):(s.splice(n,1,e),this.files=s,e=this.files[n],delete this.maps[i.id],this.maps[e.id]=e,this.emitInput(),this.emitFile(e,i),e)}return!1},emitFilter(e,t){let i=!1;return this.$emit("input-filter",e,t,(function(e=!0){return i=e,i})),i},emitFile(e,t){this.$emit("input-file",e,t),!(null==e?void 0:e.fileObject)||!e.active||t&&t.active?e&&e.fileObject&&e.active||!t||!t.fileObject||!t.active||this.uploading--:(this.uploading++,this.$nextTick((()=>{setTimeout((()=>{e&&this.upload(e).then((()=>{e&&(e=this.get(e)||void 0),(null==e?void 0:e.fileObject)&&this.update(e,{active:!1,success:!e.error})})).catch((t=>{e&&this.update(e,{active:!1,success:!1,error:t.code||t.error||t.message||t})}))}),Math.ceil(50*Math.random()+50))}))),!this.active||Boolean(e)===Boolean(t)&&e.active===t.active||this.watchActive(!0)},emitInput(){this.$emit("update:modelValue",this.files)},upload(e){const t=this.get(e);if(!t)return Promise.reject(new Error("not_exists"));if(!t.fileObject)return Promise.reject(new Error("file_object"));if(t.error)return t.error instanceof Error?Promise.reject(t.error):Promise.reject(new Error(t.error));if(t.success)return Promise.resolve(t);if(t.name&&this.iExtensions&&-1===t.name.search(this.iExtensions))return Promise.reject(new Error("extension"));if(this.size>0&&void 0!==t.size&&t.size>=0&&t.size>this.size)return Promise.reject(new Error("size"));if(this.customAction)return this.customAction(t,this);if(this.features.html5){if(this.shouldUseChunkUpload(t))return this.uploadChunk(t);if(t.putAction)return this.uploadPut(t);if(t.postAction)return this.uploadHtml5(t)}return t.postAction?this.uploadHtml4(t):Promise.reject(new Error("No action configured"))},shouldUseChunkUpload(e){return this.chunkEnabled&&!!this.chunkOptions.handler&&e.size&&e.size>this.chunkOptions.minSize},uploadChunk(e){const t=this.chunkOptions.handler;return e.chunk=new t(e,this.chunkOptions),e.chunk.upload().then((t=>e))},uploadPut(e){const t=[];let i;for(const o in e.data)i=e.data[o],null!=i&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(i));const s=e.putAction||"",n=t.length?(-1===s.indexOf("?")?"?":"&")+t.join("&"):"",r=new XMLHttpRequest;return r.open("PUT",s+n),this.uploadXhr(r,e,e.file)},uploadHtml5(e){const t=new window.FormData;let i;for(const n in e.data)i=e.data[n],i&&"object"==typeof i&&"function"!=typeof i.toString?i instanceof File?t.append(n,i,i.name):t.append(n,JSON.stringify(i)):null!=i&&t.append(n,i);t.append(this.name,e.file,e.file.name||e.file.filename||e.name);const s=new XMLHttpRequest;return s.open("POST",e.postAction||""),this.uploadXhr(s,e,t)},uploadXhr(e,t,i){let s=t,n=0,r=0;e.upload.onprogress=e=>{if(!s)return;if(s=this.get(s),!(e.lengthComputable&&s&&s.fileObject&&s.active))return;const t=Math.round(Date.now()/1e3);t!==n&&(n=t,s=this.update(s,{progress:(e.loaded/e.total*100).toFixed(2),speed:e.loaded-r}),r=e.loaded)};let o=window.setInterval((()=>{if(!(s&&(s=this.get(s))&&(null==s?void 0:s.fileObject))||s.success||s.error||!s.active){o&&(clearInterval(o),o=void 0);try{e.abort(),e.timeout=1}catch(t){}}}),100);return new Promise(((t,n)=>{if(!s)return void n(new Error("not_exists"));let r;const a=i=>{if(r)return;if(r=!0,o&&(clearInterval(o),o=void 0),!s)return n(new Error("not_exists"));if(s=this.get(s),!s)return n(new Error("not_exists"));if(!s.fileObject)return n(new Error("file_object"));if(s.error)return s.error instanceof Error?n(s.error):n(new Error(s.error));if(!s.active)return n(new Error("abort"));if(s.success)return t(s);const a={};switch(i.type){case"timeout":case"abort":a.error=i.type;break;case"error":e.status?e.status>=500?a.error="server":e.status>=400&&(a.error="denied"):a.error="network";break;default:e.status>=500?a.error="server":e.status>=400?a.error="denied":a.progress="100.00"}if(e.responseText){const t=e.getResponseHeader("Content-Type");t&&-1!==t.indexOf("/json")?a.response=JSON.parse(e.responseText):a.response=e.responseText}return s=this.update(s,a),s?s.error?s.error instanceof Error?n(s.error):n(new Error(s.error)):t(s):n(new Error("abort"))};e.onload=a,e.onerror=a,e.onabort=a,e.ontimeout=a,s.timeout&&(e.timeout=s.timeout);for(const i in s.headers)e.setRequestHeader(i,s.headers[i]);s=this.update(s,{xhr:e}),s&&e.send(i)}))},uploadHtml4(e){let t=e;if(!t)return Promise.reject(new Error("not_exists"));const i=function(e){27===e.keyCode&&e.preventDefault()},s=document.createElement("iframe");s.id="upload-iframe-"+t.id,s.name="upload-iframe-"+t.id,s.src="about:blank",s.setAttribute("style","width:1px;height:1px;top:-999em;position:absolute; margin-top:-999em;");const n=document.createElement("form");n.setAttribute("action",t.postAction||""),n.name="upload-form-"+t.id,n.setAttribute("method","POST"),n.setAttribute("target","upload-iframe-"+t.id),n.setAttribute("enctype","multipart/form-data");for(const r in t.data){let e=t.data[r];if(e&&"object"==typeof e&&"function"!=typeof e.toString&&(e=JSON.stringify(e)),null!=e){const t=document.createElement("input");t.type="hidden",t.name=r,t.value=e,n.appendChild(t)}}return n.appendChild(t.el),document.body.appendChild(s).appendChild(n),new Promise(((e,r)=>{setTimeout((()=>{if(!t)return void r(new Error("not_exists"));if(t=this.update(t,{iframe:s}),!t)return r(new Error("not_exists"));let o,a=window.setInterval((()=>{t&&(t=this.get(t))&&t.fileObject&&!t.success&&!t.error&&t.active||(a&&(clearInterval(a),a=void 0),s.onabort({type:t?"abort":"not_exists"}))}),100);const l=n=>{if(o)return;if(o=!0,a&&(clearInterval(a),a=void 0),document.body.removeEventListener("keydown",i),!t)return r(new Error("not_exists"));if(t=this.get(t),!t)return r(new Error("not_exists"));if(!t.fileObject)return r(new Error("file_object"));if(t.error)return t.error instanceof Error?r(t.error):r(new Error(t.error));if(!t.active)return r(new Error("abort"));if(t.success)return e(t);let l=function(){let e;try{s.contentWindow&&(e=s.contentWindow.document)}catch(t){}if(!e)try{e=s.contentDocument?s.contentDocument:s.document}catch(i){e=s.document}return(null==e?void 0:e.body)?e.body.innerHTML:null}();const d={};if("string"==typeof n)return r(new Error(n));switch(n.type){case"abort":d.error="abort";break;case"error":t.error?d.error=t.error:d.error=null===l?"network":"denied";break;default:t.error?d.error=t.error:null===l?d.error="network":d.progress="100.00"}if(null!==l){if(l&&"{"===l.substr(0,1)&&"}"===l.substr(l.length-1,1))try{l=JSON.parse(l)}catch(u){}d.response=l}return t=this.update(t,d),t?(null==t?void 0:t.error)?t.error instanceof Error?r(t.error):r(new Error(t.error)):e(t):r(new Error("not_exists"))};s.onload=l,s.onerror=l,s.onabort=l,document.body.addEventListener("keydown",i),n.submit()}),50)})).then((function(e){var t;return null==(t=null==s?void 0:s.parentNode)||t.removeChild(s),e})).catch((function(e){var t;return null==(t=null==s?void 0:s.parentNode)||t.removeChild(s),e}))},watchActive(e){let t,i=0;for(;t=this.files[i];)if(i++,t.fileObject)if(e&&!this.destroy){if(this.uploading>=this.thread||this.uploading&&!this.features.html5)break;t.active||t.error||t.success||this.update(t,{active:!0})}else t.active&&this.update(t,{active:!1});0===this.uploading&&(this.active=!1)},watchDrop(e,t){if(!this.features.drop)return;if(e===t)return;if(this.dropElement)try{document.removeEventListener("dragenter",this.onDragenter,!1),document.removeEventListener("dragleave",this.onDragleave,!1),document.removeEventListener("drop",this.onDocumentDrop,!1),this.dropElement.removeEventListener("dragover",this.onDragover,!1),this.dropElement.removeEventListener("drop",this.onDrop,!1)}catch(s){}let i=null;e&&(i="string"==typeof e?document.querySelector(e)||this.$root.$el.querySelector(e):!0===e?this.$parent.$el:e),this.dropElement=i,this.dropElement&&(document.addEventListener("dragenter",this.onDragenter,!1),document.addEventListener("dragleave",this.onDragleave,!1),document.addEventListener("drop",this.onDocumentDrop,!1),this.dropElement.addEventListener("dragover",this.onDragover,!1),this.dropElement.addEventListener("drop",this.onDrop,!1))},onDragenter(e){var t,i;if(e.preventDefault(),this.dropActive)return;if(!e.dataTransfer)return;const s=e.dataTransfer;(null==(t=null==s?void 0:s.files)?void 0:t.length)?this.dropActive=!0:s.types?(s.types.indexOf&&-1!==s.types.indexOf("Files")||(null==(i=s.types)?void 0:i.contains)&&s.types.contains("Files"))&&(this.dropActive=!0):this.dropActive=!0},onDragleave(e){e.preventDefault(),this.dropActive&&("HTML"===e.target.nodeName||e.target===e.explicitOriginalTarget||!e.fromElement&&(e.clientX<=0||e.clientY<=0||e.clientX>=window.innerWidth||e.clientY>=window.innerHeight))&&(this.dropActive=!1)},onDragover(e){e.preventDefault()},onDocumentDrop(){this.dropActive=!1},onDrop(e){e.preventDefault(),e.dataTransfer&&this.addDataTransfer(e.dataTransfer)},async inputOnChange(e){if(!(e.target instanceof HTMLInputElement))return Promise.reject(new Error("not HTMLInputElement"));e.target;const t=e=>(this.reload=!0,this.$nextTick((()=>{this.reload=!1})),e);return this.addInputFile(e.target).then(t).catch(t)}}}),K=["for"],Q=["name","id","accept","capture","disabled","webkitdirectory","allowdirs","directory","multiple"];var Z=e(Y,[["render",function(e,t,i,n,r,o){return s(),l("span",{class:f(e.className)},[h(e.$slots,"default"),p("label",{for:e.forId},null,8,K),e.reload?g("",!0):(s(),l("input",{key:0,ref:"input",type:"file",name:e.name,id:e.forId,accept:e.accept,capture:e.capture,disabled:e.disabled,webkitdirectory:e.directory&&e.features.directory,allowdirs:e.directory&&e.features.directory,directory:e.directory&&e.features.directory,multiple:e.multiple&&e.features.html5,onChange:t[0]||(t[0]=(...t)=>e.inputOnChange&&e.inputOnChange(...t))},null,40,Q))],2)}]]);class ee extends x{get status(){return this._status}set status(e){this._status=e}get publicPath(){return this._publicPath}set publicPath(e){this._publicPath=e}get localFileName(){return this._localFileName}set localFileName(e){this._localFileName=e}get uploadId(){return this._uploadId}set uploadId(e){this._uploadId=e}static fromJson(e){let t=new ee;t.prefillBaseFields(e);try{var i=JSON.parse(e)}catch(s){E.throwJsonParsingError("UploadResponse",s,e)}return t.status=i.status,t.publicPath=i.publicPath,t.localFileName=i.localFileName,t.uploadId=i.uploadId,t}}class te{get fileNameValidationRegexps(){return this._fileNameValidationRegexps}set fileNameValidationRegexps(e){this._fileNameValidationRegexps=e}get identifier(){return this._identifier}set identifier(e){this._identifier=e}get maxFileSizeMb(){return this._maxFileSizeMb}set maxFileSizeMb(e){this._maxFileSizeMb=e}get isMultiUpload(){return this._isMultiUpload}set isMultiUpload(e){this._isMultiUpload=e}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e}get allowedMimeTypes(){return this._allowedMimeTypes}set allowedMimeTypes(e){this._allowedMimeTypes=e}get allowNaming(){return this._allowNaming}set allowNaming(e){this._allowNaming=e}}class ie extends x{get configuration(){return this._configuration}set configuration(e){this._configuration=e}static fromJson(e){let t=new ie;t.prefillBaseFields(e);try{var i=JSON.parse(e)}catch(n){E.throwJsonParsingError("GetUploadConfigurationResponse",n,e)}let s=new te;return s.isMultiUpload=i.configuration.multiUpload,s.allowedExtensions=i.configuration.allowedExtensions,s.allowedMimeTypes=i.configuration.allowedMimeTypes,s.fileNameValidationRegexps=i.configuration.fileNameValidationRegexps,s.identifier=i.configuration.identifier,s.maxFileSizeMb=i.configuration.maxFileSizeMb,s.allowNaming=i.configuration.allowNaming,t._configuration=s,t}}const se={data:()=>({files:[],upload:{},configuration:{},url:{upload:k.buildUrl(j.UPLOAD_FILES)}}),props:{canUpload:{type:Boolean,required:!1,default:!0},configurationId:{type:String,required:!0},extraData:{type:Object,required:!1,default:function(){return{}}}},emits:["uploadFinished"],mixins:[z],components:{MediumButtonWithIcon:S,VueUploadComponent:Z,UploadedFilesList:J,Container:F,la:r},computed:{areAllowedExtensionsSet(){return Object.keys(this.configuration).length>1&&this.configuration.allowedExtensions.length>0},areAllowedMimeTypesSet(){return Object.keys(this.configuration).length>1&&this.configuration.allowedMimeTypes.length>0},configuredMimeTypesString(){return Object.keys(this.configuration).length>1?this.configuration.allowedMimeTypes.join(","):""},configuredExtensionsString(){return Object.keys(this.configuration).length>1?this.configuration.allowedExtensions.join(","):""},allowedSizeBytes(){return 1048576*this.configuration.maxFileSizeMb}},methods:{onInputFilter(e,t,i){return this.isFileAlreadyUploaded(e)?i():this.isFileSizeValid(e)&&this.isFileNameValid(e)&&this.isExtensionValid(e)?void 0:(this.$refs.upload.remove(e),i())},isFileSizeValid(e){var t;if(void 0===e)return!0;let i=e.size;if(this.allowedSizeBytes&&i>this.allowedSizeBytes){let e=this.$t("generic.form.upload.test.fileToBig")+(null==(t=this.configuration)?void 0:t.maxFileSizeMb);return this.$rootEvent.showNotification(C.info,e),!1}return!0},isFileNameValid(e){var t;return void 0===e||!(null==(t=e.name)?void 0:t.includes(".."))||(this.$rootEvent.showNotification(C.info,this.$t("generic.form.upload.test.invalidName")),!1)},isFileAlreadyUploaded(e){if(void 0===e)return!1;for(let t of this.files)if(t.name===e.name&&t.size===e.size&&t.id!==e.id){let t=this.$t("generic.form.upload.test.fileAlreadyOnList")+e.name;return this.$rootEvent.showNotification(C.info,t),!0}return!1},isExtensionValid(e){if(void 0===e||0===this.configuration.allowedExtensions.length)return!0;let t=e.name.replace(/.*\./,"").toLowerCase();return!!this.configuration.allowedExtensions.map((e=>e.toLowerCase())).includes(t)||(this.$rootEvent.showNotification(C.info,this.$t("generic.form.upload.test.extensionNotAllowed")+t),!1)},inputFile(e,t){},onRemoveFile(e){this.$refs.upload.remove(e)},decideUploadedFileStatus:e=>e.status,async getBase64FileContent(e){let t=new Promise(((t,i)=>{let s=new FileReader,n=()=>{let t=this.$t("messages.internalServerError");I.error(`Could not read the file: ${e.name}`),this.$rootEvent.showNotification(C.error,t)};s.onloadend=()=>{let e=s.result,i=new RegExp(/data:.*;base64,/),n=e.replace(i,"");t(n)},s.onerror=()=>{n(),i()},s.onabort=()=>{n(),i()},e.file?s.readAsDataURL(e.file):(n(),I.error("There is no file data to read."),i())}));return await t},async handleUpload(e){var t,i;let s={fileContent:await this.getBase64FileContent(e),fileName:e.name,fileSize:e.size,userDefinedName:null!=(t=e.userDefinedName)?t:"",tags:null!=(i=e.tags)?i:[],uploadConfigId:this.configuration.identifier,extraData:this.extraData};this.$rootEvent.showFullPageLoader();let n=await this.$axios.post(this.url.upload,s,ee).then((e=>(e.isMessageSet()&&this.$rootEvent.showNotification(e.getNotificationType(!0),e.message),e)));return e.status=this.decideUploadedFileStatus(n),e.uploadHandled=!0,this.$rootEvent.hideFullPageLoader(),this.$emit("uploadFinished",{isSuccess:n.success,message:n.message,status:n.status}),e},async getUploadConfiguration(){let e=k.buildUrl(j.GET_UPLOAD_CONFIGURATION,{[j.GET_UPLOAD_CONFIGURATION_PARAM_ID]:this.configurationId});this.$axios.get(e,ie).then((e=>{this.configuration=e.configuration}))}},async created(){await this.getUploadConfiguration()}},ne={class:"example-simple"},re={class:"h1-blue text-xl"},oe={class:"flex justify-center"},ae={class:"uploaded-data-list mt-5"},le={class:"mt-2"},de={key:0,class:"block"},ue={class:"font-bold"},ce={key:1,class:"block"},he={class:"font-bold"},pe={key:2,class:"block"},fe={class:"font-bold"},me={key:3,class:"block"},ge=(we=()=>p("span",{class:"font-bold"},"*",-1),O("data-v-51dc89bc"),we=we(),N(),we),ve={class:"font-bold"},ye={class:"italic"},be={class:"actions flex justify-center sm:flex-row flex-wrap mt-5 flex-col"};var we;const xe={data:()=>({initialSmallSizeModal:"medium"}),props:{configurationId:{type:String,required:!0},isVisible:{type:Boolean,required:!1,default:!1},extraData:{type:Object,required:!1,default:function(){return{}}},refreshStorageState:{type:Boolean,default:!1,required:!1}},emits:["uploadFinished"],components:{Upload:e(se,[["render",function(e,t,r,o,a,d){const u=i("UploadedFilesList"),f=i("la"),y=i("MediumButtonWithIcon"),w=i("VueUploadComponent"),x=i("Container");return s(),n(x,null,{default:c((()=>[p("div",ne,[p("h1",re,m(e.$t("generic.form.upload.header")),1),p("div",oe,[p("div",ae,[v(u,{files:a.files,configuration:a.configuration,onRemoveFile:d.onRemoveFile},null,8,["files","configuration","onRemoveFile"]),p("p",le,[a.configuration.maxFileSizeMb>0?(s(),l("small",de,[p("span",ue,m(e.$t("generic.form.upload.test.maxFileSize")),1),p("span",null,m(a.configuration.maxFileSizeMb)+" Mb",1)])):g("",!0),d.areAllowedExtensionsSet?(s(),l("small",ce,[p("span",he,m(e.$t("generic.form.upload.test.allowedFileExtensions")),1),p("span",null,m(d.configuredExtensionsString),1)])):g("",!0),d.areAllowedMimeTypesSet?(s(),l("small",pe,[p("span",fe,m(e.$t("generic.form.upload.test.allowedMimeTypes")),1),p("span",null,m(d.configuredMimeTypesString),1)])):g("",!0),a.configuration.allowNaming?(s(),l("small",me,[ge,p("span",ve,m(e.$t("generic.form.upload.test.allowedNameCharacters")),1),p("span",null,m(e.$t("generic.form.upload.test.allowedCharactersList")),1),p("span",ye,"("+m(e.$t("generic.form.upload.test.anyOtherCharactersWillBeRemoved"))+")",1)])):g("",!0)]),h(e.$slots,"beforeActions",{},void 0,!0),p("div",be,[v(y,{text:e.$t("generic.form.upload.button.select.label"),"button-classes":"action-button",class:"action",onClick:t[0]||(t[0]=t=>e.$refs.upload.$refs.input.click())},{icon:c((()=>[v(f,{"svg-icon-name":"hand-pointer",color:"white"})])),_:1},8,["text"]),e.$refs.upload&&e.$refs.upload.active?g("",!0):(s(),n(y,{key:0,text:e.$t("generic.form.upload.button.upload.label"),disabled:!r.canUpload,onClick:t[1]||(t[1]=b((t=>e.$refs.upload.active=!0),["prevent"])),"button-classes":"action-button",class:"action"},{icon:c((()=>[v(f,{"svg-icon-name":"file-upload-solid",color:"white"})])),_:1},8,["text","disabled"])),e.$refs.upload&&e.$refs.upload.active?g("",!0):(s(),n(y,{key:1,text:e.$t("generic.form.upload.button.clearList.label"),onClick:t[2]||(t[2]=b((e=>a.files=[]),["prevent"])),"button-classes":"action-button",class:"action"},{icon:c((()=>[v(f,{"svg-icon-name":"times-circle-solid",color:"white"})])),_:1},8,["text"]))]),h(e.$slots,"afterActions",{},void 0,!0)])])]),v(w,{class:"upload-component","custom-action":d.handleUpload,extensions:a.configuration.allowedExtensions,accept:d.configuredMimeTypesString,multiple:a.configuration.isMultiUpload,size:d.allowedSizeBytes,modelValue:a.files,"onUpdate:modelValue":t[3]||(t[3]=e=>a.files=e),onInputFilter:d.onInputFilter,onInputFile:d.inputFile,ref:"upload"},null,8,["custom-action","extensions","accept","multiple","size","modelValue","onInputFilter","onInputFile"])])),_:3})}],["__scopeId","data-v-51dc89bc"]]),Modal:T},mixins:[A,$],methods:{onUploadFinish(){this.refreshStorageState&&_().getAll()}}},Ee={class:"modal-wrapper"};var ke=e(xe,[["render",function(e,t,n,r,o,a){const d=i("Upload"),u=i("Modal");return s(),l("div",Ee,[v(u,{title:e.$t("generic.dialog.uploadDialog.header"),"is-visible":n.isVisible,onModalClosed:t[0]||(t[0]=t=>e.$emit("modalClosed")),size:e.modalSize,"is-close-full-width":!0},{content:c((()=>[v(d,{"configuration-id":n.configurationId,"extra-data":n.extraData,onUploadFinished:a.onUploadFinish},null,8,["configuration-id","extra-data","onUploadFinished"])])),_:1},8,["title","is-visible","size"])])}]]);export{U as T,ke as U};
