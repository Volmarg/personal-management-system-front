import{S as e,B as s,E as t,_ as i,s as l,a,V as r,I as o,A as n,M as d,T as c,b as u,U as m,L as f,c as g,d as p,C as h,r as b,o as w,e as v,f as x,w as y,t as T,g as _,h as k,i as E,j as S,k as D,n as P,p as $,l as A}from"./index.93e753e6.js";import{_ as F}from"./DemoAwareMixin.e29999cc.js";import{u as L,e as O,c as R,r as C,_ as N}from"./index.esm.acd14812.js";class I extends e{}I.GET_PUBLIC_FOLDER_ACCESS_TOKEN="/system/access-token/get-for-public-folder",I.GET_PASSWORD_CONSTRAINTS="/system/get-password-constraints",I.HTML_TO_PDF_PAGES="/system-file/converter/html-to-pdf-pages",I.HTML_TO_SINGLE_PDF="/system-file/converter/html-to-single-pdf";class U extends s{get publicFolderAccessToken(){return this._publicFolderAccessToken}set publicFolderAccessToken(e){this._publicFolderAccessToken=e}static fromJson(e){let s=new U;s.prefillBaseFields(e);try{var i=JSON.parse(e)}catch(l){t.throwJsonParsingError("GetPublicFolderAccessTokenResponse",l,e)}return s.publicFolderAccessToken=i.publicFolderAccessToken,s}}const M={name:"Login",setup:()=>({v$:L()}),data:()=>({canRegister:!1,systemDisabledState:l(),isDev:a.isDev(),email:a.isDemo()?a.getPrefilledLoginEmail():"",password:a.isDemo()?a.getPrefilledLoginPassword():"",routePaths:{registerPage:r.ROUTE_PATH_REGISTER},violations:{email:[],password:[]}}),validations(){return{email:{email:O,required:R.withMessage(this.$t("validations.required"),C)},password:{required:R.withMessage(this.$t("validations.required"),C)}}},emits:["loginSuccess","showNotification"],mixins:[{methods:{async getPublicFolderAccessToken(){let s=e.buildUrl(I.GET_PUBLIC_FOLDER_ACCESS_TOKEN);return await this.$axios.get(s,U).then((e=>e.publicFolderAccessToken))}}},F,N],components:{"vue-input":o,"asterisk-required":n,MediumButtonWithIcon:d},methods:{validate(){this.v$.$validate(),this.violations=this.vuelidateErrorsToPropsViolation(this.v$.$errors)},async handleSubmit(){if(this.systemDisabledState.isDisabled)return;let s={username:this.email,password:this.password};this.validate(),this.isVuelidateResultValid?(this.$rootEvent.showFullPageLoader(),this.$axios.post(e.buildUrl(u.URL_LOGIN),s).then((async e=>{if((new m).isUserActive()){let e=await this.getPublicFolderAccessToken();e||console.error("Could net get public dir token"),f.set(f.PUBLIC_FOLDER_AUTHENTICATION_TOKEN,e)}if(g.isEmptyString(e.token)){let s=this.$t("messages.internalServerError");return e.isMessageSet()&&(s=e.message),this.$rootEvent.showNotification(c.error,s),void this.$rootEvent.hideFullPageLoader()}this.$rootEvent.hideFullPageLoader(),f.set(f.AUTHENTICATION_TOKEN,e.token),this.$router.push(r.ROUTE_PATH_HOME),this.$emit("loginSuccess")})).catch((e=>{p.error("Got error while trying to get authentication token",{error:e}),this.$router.push(r.ROUTE_PATH_LOGIN)}))):this.$rootEvent.showNotification(c.warning,this.$t("login.incorrectFormData"))},prefillEmail(){a.isDemo()?this.email=h.general.demo.user.login:this.email=""},prefillPassword(){a.isDemo()?this.password=h.general.demo.user.password:this.password=""}},async beforeMount(){let e=await this.$axios.get(u.buildUrl(u.URL_CAN_REGISTER_CHECK));this.canRegister=200===e.code,this.prefillEmail(),this.prefillPassword()}},j=e=>($("data-v-697f8ba3"),e=e(),A(),e),H={id:"__next"},G={class:"w-full flex lg:flex-row lg:h-screen overflow-hidden flex-col-reverse"},V={class:"lg:flex lg:flex-col w-full lg:w-1/2 text-white p-8 items-start justify-between relative background"},q={class:"uppercase font-bold text-base tracking-wider flex flex-row items-center lg:justify-start w-full whitespace-nowrap text-white justify-center mb-8 lg:mb-0"},K=[j((()=>x("img",{src:"/assets/logo-white.d8b43a19.svg"},null,-1)))],B={class:"flex flex-col w-full"},J={class:"text-2xl font-bold mb-4 text-center"},W=["innerHTML"],z=j((()=>x("div",{class:"flex flex-row items-center lg:justify-between justify-center mt-4 lg:mt-0 w-full text-xs z-10"},[x("div",{class:"text-white"},"Â© Personal Management System")],-1))),Q={class:"w-full lg:w-1/2 bg-white p-8 lg:p-24 flex flex-col items-center justify-center lg:items-start mb-8 sm:mb-20"},X={class:"text-2xl font-bold text-blue-500 mb-4"},Y={key:0},Z=[j((()=>x("small",null,"[Dev-System] Prefilled credentials",-1)))],ee={key:1},se=[j((()=>x("small",null,"[Demo-System] Prefilled credentials",-1)))],te={class:"flex flex-col"},ie={class:"form flex flex-wrap w-full"},le={class:"w-full"},ae={class:"mb-2 justify-start flex"},re={class:"w-full sm:w-auto mb-4"},oe={key:0,class:"flex-row text-md"},ne={href:"https://github.com/Volmarg",target:"_blank"},de={href:"https://volmarg.github.io/",target:"_blank"},ce={key:2,class:"flex flex-row w-full mt-1 justify-center lg:justify-start"},ue={class:"text-secondary mr-1"};var me=i(M,[["render",function(e,s,t,i,l,a){const r=b("vue-input"),o=b("asterisk-required"),n=b("la"),d=b("MediumButtonWithIcon"),c=b("fa"),u=b("router-link");return w(),v("div",null,[x("div",H,[x("div",G,[x("div",V,[x("div",q,[x("a",{class:"flex flex-row items-center justify-start space-x-2 logo-link cursor-default",onClick:s[0]||(s[0]=y((()=>{}),["prevent"]))},K)]),x("div",B,[x("p",J,T(e.$t("security.login.welcomeTo"))+" Personal Management System! ",1),x("p",{class:"text-sm",innerHTML:e.$t("security.login.info.line1")},null,8,W)]),z]),x("div",Q,[x("p",X,T(e.$t("security.login.loginHeader")),1),l.isDev&&!e.isDemo?(w(),v("p",Y,Z)):_("",!0),e.isDemo&&!l.isDev?(w(),v("p",ee,se)):_("",!0),x("div",te,[x("form",ie,[x("div",le,[k(r,{type:"text",label:e.$t("security.login.loginForm.email.label"),"is-required":!0,errors:l.violations.email,"is-disabled":l.systemDisabledState.isDisabled,onKeypress:E(y(a.handleSubmit,["prevent"]),["enter"]),modelValue:l.email,"onUpdate:modelValue":s[1]||(s[1]=e=>l.email=e),modelModifiers:{trim:!0}},null,8,["label","errors","is-disabled","onKeypress","modelValue"]),k(r,{type:"password",label:e.$t("security.login.loginForm.password.label"),"is-required":!0,errors:l.violations.password,"is-disabled":l.systemDisabledState.isDisabled,onKeypress:E(y(a.handleSubmit,["prevent"]),["enter"]),modelValue:l.password,"onUpdate:modelValue":s[2]||(s[2]=e=>l.password=e)},null,8,["label","errors","is-disabled","onKeypress","modelValue"]),x("p",ae,[S(T(e.$t("generic.asteriskFieldsAreRequired")),1),k(o)])]),x("div",re,[k(d,{text:e.$t("security.login.loginForm.submit.label"),"button-classes":"w-full sm:w-auto flex justify-center",disabled:l.systemDisabledState.isDisabled,onClick:y(a.handleSubmit,["prevent"])},{icon:D((()=>[k(n,{"svg-icon-name":"shield-alt-solid",color:"white"})])),_:1},8,["text","disabled","onClick"])])]),e.isDemo?(w(),v("div",oe,[x("div",null,[x("a",ne,[k(c,{icon:["fab","github"],class:"social-icon"}),x("span",null,T(e.$t("security.login.links.repository.label")),1)])]),x("div",null,[x("a",de,[k(c,{icon:"bookmark",class:"social-icon"}),x("span",null,T(e.$t("security.login.links.documentation.label")),1)])])])):_("",!0)]),l.canRegister?(w(),v("div",ce,[x("span",ue,T(e.$t("security.login.links.register.label")),1),x("span",null,[k(u,{to:l.routePaths.registerPage,class:P(["link",{"disabled-text-link":l.systemDisabledState.isDisabled}])},{default:D((()=>[S(T(e.$t("security.login.links.register.linkText")),1)])),_:1},8,["to","class"])])])):_("",!0)])])])])}],["__scopeId","data-v-697f8ba3"]]);export{me as default};
