import{A as e,a as t,B as a}from"./Base.ed256b75.js";import{_ as l,r as s,o as n,e as o,f as r,t as i,h as d,g as m,aS as u,Y as p,M as c,aI as h,I as y,aW as f,B as b,k as P,aE as v,aF as C,c as Y,aa as w,af as S,j as x,aY as A}from"./index.96856189.js";import{Y as I}from"./YearSelect.553450f6.js";import{S as V}from"./SimpleTable.3c40fd1c.js";import{T as g}from"./PaymentTypeSelect.244d59f9.js";import{S as F}from"./SymfonyPaymentsRoutes.fde83a6a.js";import{T as M}from"./TableActions.a663c780.js";import"./BrowserDetection.6a5570eb.js";import"./ColorBorderBar.0bd7bab9.js";import"./SearchInput.1906b730.js";import"./ClipboardService.8ea6182d.js";const j={key:0,class:"flex flex-col justify-end"},T={class:"text-lg text-center md:text-right pr-0 md:pr-6 mb-1"},$={class:"w-full flex justify-end"},B={class:"w-full md:w-1/2 lg:w-1/3 xl:w-1/6"};var N=l({data:()=>({selectedYear:null}),props:{preselectedYear:{type:[String,null],required:!1,default:null},data:{type:Object,required:!0}},emits:["yearFilterChange"],components:{YearSelect:I},computed:{years(){return Object.keys(this.data)}},beforeMount(){this.selectedYear=this.preselectedYear},watch:{selectedYear(){this.$emit("yearFilterChange",this.selectedYear)},preselectedYear(){this.selectedYear=this.preselectedYear}}},[["render",function(e,t,a,l,u,p){const c=s("YearSelect");return p.years.length>0?(n(),o("div",j,[r("div",null,[r("h2",T,i(e.$t("payments.monthly.filter.label")),1)]),r("div",$,[r("div",B,[d(c,{years:p.years,"allow-all-option":!0,modelValue:u.selectedYear,"onUpdate:modelValue":t[0]||(t[0]=e=>u.selectedYear=e)},null,8,["years","modelValue"])])])])):m("",!0)}]]),k=l({data(){return{allYears:[],yearFilter:null,headers:[{label:"id",dataValuePath:"id.value",isVisible:!1,dataIsComponentPath:null,dataComponentPropertiesPath:null},{label:"typeId",dataValuePath:"typeId.value",isVisible:!1,dataIsComponentPath:null,dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.date.label"),dataValuePath:"date.value",dataIsComponentPath:"date.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.money.label"),dataValuePath:"money.value",dataIsComponentPath:"money.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.description.label"),dataValuePath:"description.value",dataIsComponentPath:"description.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.type.label"),dataValuePath:"typeName.value",dataIsComponentPath:"typeName.isComponent",dataComponentPropertiesPath:null},{label:this.$t("payments.monthly.table.headers.actions.label"),dataValuePath:"actions.value",dataIsComponentPath:"actions.isComponent",dataComponentPropertiesPath:"actions.componentProps"}]}},props:{data:{type:Array,required:!0}},components:{NoResultsText:u,SimpleTable:V},computed:{usedData(){let e=[];for(let t of this.data)this.yearFilter&&t.values.year.value!=this.yearFilter||e.push(t);return e}}},[["render",function(e,t,a,l,o,r){const i=s("SimpleTable"),d=s("NoResultsText");return a.data.length>0?(n(),p(i,{key:0,headers:o.headers,data:r.usedData,ref:"table",class:"mt-4"},null,8,["headers","data"])):(n(),p(d,{key:1}))}]]);const _={class:"flex justify-center"},q={class:"mt-6 md:w-1/2 lg:w-1/3 w-full flex flex-col"},E={class:"text-lg"};var D=l({data:()=>({form:{date:null,money:null,description:null,typeId:null}}),props:{id:{type:[Number,null],required:!1,default:null},date:{type:[String,null],required:!1,default:null},money:{type:[Number,null],required:!1,default:null},description:{type:[String,null],required:!1,default:null},typeId:{type:[Number,null],required:!1,default:null}},components:{MediumButtonWithIcon:c,Container:h,FormInput:y,TypeSelect:g},methods:{clearForm(){this.form.typeId=null,this.form.date=null,this.form.description=null,this.form.money=null},async onSubmit(){let e,t=new f(F.MONTHLY_BASE_URL,this.id,b,this.form);t.reload=!1,e=this.id?await this.$moduleCall.update(t):await this.$moduleCall.new(t),e.success&&(this.$emit("submit"),this.clearForm())}},beforeMount(){this.form.typeId=this.typeId,this.form.date=this.date,this.form.description=this.description,this.form.money=this.money}},[["render",function(e,t,a,l,o,m){const u=s("FormInput"),c=s("TypeSelect"),h=s("MediumButtonWithIcon"),y=s("Container");return n(),p(y,null,{default:P((()=>[r("div",_,[r("div",q,[r("h2",E,i(e.$t("payments.monthly.newForm.header")),1),d(u,{type:"date",modelValue:o.form.date,"onUpdate:modelValue":t[0]||(t[0]=e=>o.form.date=e),"is-required":!0,label:e.$t("payments.monthly.newForm.date.label")},null,8,["modelValue","label"]),d(u,{type:"number",modelValue:o.form.money,"onUpdate:modelValue":t[1]||(t[1]=e=>o.form.money=e),"is-required":!0,label:e.$t("payments.monthly.newForm.money.label")},null,8,["modelValue","label"]),d(u,{type:"text",modelValue:o.form.description,"onUpdate:modelValue":t[2]||(t[2]=e=>o.form.description=e),"is-required":!0,label:e.$t("payments.monthly.newForm.description.label")},null,8,["modelValue","label"]),d(c,{modelValue:o.form.typeId,"onUpdate:modelValue":t[3]||(t[3]=e=>o.form.typeId=e)},null,8,["modelValue"]),d(h,{text:e.$t("payments.monthly.newForm.submit.label"),"button-extra-classes":"pt-3 pb-3 sm:pt-1 sm:pb-1",class:"w-full mb-1 md:col-start-1 md:col-end-2 mt-6","button-classes":"w-full md:w-auto m-0-force","text-classes":"text-center w-full",onButtonClick:m.onSubmit},null,8,["text","onButtonClick"])])])])),_:1})}]]);const U=v("paymentMonthlyState",{state:()=>({allEntries:[]}),actions:{async getAll(){this.allEntries=await(new C).getAll(F.MONTHLY_BASE_URL)}}}),O={class:"mt-4 flex justify-center"},L={key:0,class:"mt-2"},R={class:"font-bold"};var H=l({data:()=>({form:{date:null,money:null,description:null,type:null},selectedYear:null,store:null,allPayments:[]}),components:{Accordion:e,AccordionPanel:t,Base:a,Navbar:N,PaymentsTable:k,Container:h,AddEditForm:D},computed:{paymentsData(){let e=[];for(let t of this.allPayments)e.push({values:{id:{value:t.id,isComponent:!1},date:{value:t.date,isComponent:!1},money:{value:t.money,isComponent:!1},description:{value:t.description,isComponent:!1},typeName:{value:t.typeName,isComponent:!1},typeId:{value:t.typeId,isComponent:!1},actions:{value:M,isComponent:!0,componentProps:{editActionForm:D,baseUrl:F.MONTHLY_BASE_URL,store:U}}}});return e},accordionsData(){if(!this.selectedYear){let e={};for(let t in this.dataPerYearsAndMonths)e={...e,...this.dataPerYearsAndMonths[t]};return e}return this.dataPerYearsAndMonths[this.selectedYear]},dataPerYearsAndMonths(){let e={};for(let t of this.paymentsData){let a=t.values.date.value.match(/[0-9]{4}/),l=t.values.date.value.match(/[0-9]{4}-[0-9]{2}/);e[a]||(e[a]={}),e[a][l]||(e[a][l]=[]),e[a][l].push(t)}return e}},methods:{paymentSummaryData(e){let t={},a=0,l=e.match(/[0-9]{4}/);for(let s of this.dataPerYearsAndMonths[l][e]){let e=Y.ucFirst(s.values.typeName.value);t[e]||(t[e]=0),t[e]+=s.values.money.value,a+=s.values.money.value}t[this.$t("payments.monthly.text.summary")]=a;for(let s in t){let e=t[s];t[s]=e.toFixed(2)}return t},paymentTotal(e){let t=0,a=e.match(/[0-9]{4}/);for(let l of this.dataPerYearsAndMonths[a][e])t+=l.values.money.value;return t.toFixed(2)},async refreshPageState(){await this.store.getAll(),this.allPayments=this.store.allEntries,this.selectedYear=Math.max(...Object.keys(this.dataPerYearsAndMonths).sort())}},async beforeMount(){this.store=U(),await this.refreshPageState()},watch:{"store.allEntries":{deep:!0,handler:function(){this.allPayments=this.store.allEntries,this.selectedYear=Math.max(...Object.keys(this.dataPerYearsAndMonths).sort())}}}},[["render",function(e,t,a,l,u,c){const h=s("Navbar"),y=s("PaymentsTable"),f=s("Container"),b=s("AccordionPanel"),v=s("Accordion"),C=s("AddEditForm");return n(),o(w,null,[d(h,{data:c.dataPerYearsAndMonths,"preselected-year":u.selectedYear,onYearFilterChange:t[0]||(t[0]=e=>u.selectedYear=e),class:"mb-6 mt-6 sm:mt-0"},null,8,["data","preselected-year"]),(n(!0),o(w,null,S(c.accordionsData,((t,a)=>(n(),p(v,{key:a},{default:P((()=>[d(b,{class:"accordion-panel"},{title:P((()=>[x(i(a)+" ("+i(c.paymentTotal(a))+")",1)])),content:P((()=>[d(f,{class:"mb-6"},{default:P((()=>[d(y,{data:t},null,8,["data"]),r("div",O,[r("ul",null,[(n(!0),o(w,null,S(c.paymentSummaryData(a),((t,a)=>(n(),o("li",{key:a,class:"text-lg text-right"},[a===e.$t("payments.monthly.text.summary")?(n(),o("hr",L)):m("",!0),r("span",R,i(a)+": ",1),r("span",null,i(t),1)])))),128))])])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128)),d(C,{onSubmit:c.refreshPageState},null,8,["onSubmit"])],64)}]]),W=l({components:{Tabs:A,Base:a},computed:{tabsContent(){return[{tabName:this.$t("payments.monthly.tabs.overview.label"),tabComponent:H}]}}},[["render",function(e,t,a,l,o,r){const i=s("Tabs"),m=s("Base");return n(),p(m,{"info-block-description":e.$t("payments.monthly.description"),"is-in-container":!1},{default:P((()=>[d(i,{"tabs-with-content":r.tabsContent,"no-background":!0},null,8,["tabs-with-content"])])),_:1},8,["info-block-description"])}]]);export{W as default};
