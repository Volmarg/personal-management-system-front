import{S as e}from"./SimpleTable.7f9e58e8.js";import{C as a}from"./ColoredSwitch.bc5dc7a6.js";import{_ as o,aH as t,a as n,a3 as s,a2 as l,a$ as d,L as i,ax as m,ae as u,r as c,o as h,e as r,f as p,t as k,Y as f,g as C,aY as g,B as L}from"./index.daf34ba3.js";import{C as b}from"./CategoriesState.60c5580a.js";import"./SearchInput.c3a307a8.js";import"./VuelidateHandler.c5fcca12.js";const P={class:"mt-10"},S={class:"text-lg"};var V=o({data(){return{moduleLocksTableId:"moduleLocks",moduleLocks:[],isPageDataChanging:!1,lockStateChangeHooks:{[t.notes]:(e,a)=>{e&&!a&&b().getAll()}},headers:[{label:"id",isVisible:!1,dataValuePath:"id.value",dataIsComponentPath:null,dataComponentPropertiesPath:null},{label:this.$t("systemSettings.tab.modules.lock.table.headers.name.label"),dataValuePath:"name.value",dataIsComponentPath:"name.isComponent",dataComponentPropertiesPath:null},{label:this.$t("systemSettings.tab.modules.lock.table.headers.isLocked.label"),dataValuePath:"isLocked.value",dataIsComponentPath:"isLocked.isComponent",dataComponentPropertiesPath:"isLocked.componentProps",dataComponentModelValuePath:"isLocked.componentModelValue"},{label:this.$t("systemSettings.tab.modules.lock.table.headers.info.label"),dataValuePath:"info.value",dataIsComponentPath:"info.isComponent",dataComponentPropertiesPath:"info.componentProps",dataComponentModelValuePath:"info.componentModelValue"}]}},components:{SimpleTable:e},computed:{data(){let e=[];for(let o of this.moduleLocks){let l={values:{id:{value:o.name,isComponent:!1,isVisible:!1},name:{value:this.$t("other.moduleName.backendToFrontendMapping."+o.name),isComponent:!1},isLocked:{value:a,isComponent:!0,componentModelValue:o.isLocked,componentProps:{disabled:n.isDemo()}}}};o.name===t.storage&&(l.values.info={value:s,isComponent:!0,componentModelValue:null,componentProps:{text:this.$t("systemSettings.tab.modules.lock.table.info.storage")}}),e.push(l)}return e}},methods:{isLocked(e){let a=this.moduleLocks.find((a=>a.name===e));if(!a)throw new l(`No lock data found for module named ${e}`);return a.isLocked},onComponentValueChange(e){this.isPageDataChanging||e.tableId==this.moduleLocksTableId&&this.$nextTick((()=>{this.onModuleLockChange()}))},async onModuleLockChange(){var e,a;let o=[];for(let s of this.$refs.table.rowsData){let t=null==(e=s.find((e=>"isLocked"===e.fieldId)))?void 0:e.uniqId,n=null==(a=s.find((e=>"id"===e.fieldId)))?void 0:a.value,i=this.$refs.table.componentValues[t];if(d.isUndefined(n)||d.isUndefined(i))throw new l("Could not read the module name or lock state",{colsData:s,isLocked:i,name:n});o.push({name:n,isLocked:i})}let t={moduleLocks:o},n=new g(u.SETTINGS_MODULES_LOCK_BASE,null,L,t);n.reload=!1,this.executeLockChangeHooks(o),await this.$moduleCall.update(n),await this.fetchModuleLocksData()},executeLockChangeHooks(e){let a=i.getAuthToken();for(let o of e){let e=this.lockStateChangeHooks[o.name];if(e instanceof Function){let t=this.isLocked(o.name);m.authTokenUpdatePromise(a).then((()=>{e(t,o.isLocked)}))}}},async fetchModuleLocksData(){this.moduleLocks=await this.$moduleCall.getAll(u.SETTINGS_MODULES_LOCK_BASE)}},beforeMount(){this.fetchModuleLocksData()}},[["render",function(e,a,o,t,n,s){const l=c("SimpleTable");return h(),r("div",P,[p("h2",S,k(e.$t("systemSettings.tab.modules.lock.header")),1),s.data.length>0?(h(),f(l,{key:0,headers:n.headers,data:s.data,ref:"table",id:n.moduleLocksTableId,onComponentValueChange:s.onComponentValueChange,onBeforePageChange:a[0]||(a[0]=e=>n.isPageDataChanging=!0),onAfterTableRowsHandled:a[1]||(a[1]=e=>n.isPageDataChanging=!1)},null,8,["headers","data","id","onComponentValueChange"])):C("",!0)])}]]);export{V as default};
