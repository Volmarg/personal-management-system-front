import{S as e}from"./SimpleTable.41d39b19.js";import{C as a}from"./ColoredSwitch.954a360d.js";import{C as o}from"./CategoriesState.59ec78e7.js";import{_ as t,a as s,a2 as n,a_ as l,L as d,ax as i,ae as m,r as c,o as r,e as h,f as u,t as p,Y as k,g as C,aX as g,B as f}from"./index.5c1c3a9f.js";import"./SearchInput.64a02e4e.js";import"./VuelidateHandler.ffbf1da4.js";var L,b=((L=b||{}).achievements="Achievements",L.issues="My Issues",L.calendar="My Schedules",L.contacts="My Contacts",L.files="My Files",L.images="My Images",L.videos="My Video",L.goals="My Goals",L.todo="My Todo",L.job="My Job",L.notes="My Notes",L.passwords="My Passwords",L.payments="My Payments",L.shopping="My Shopping",L.travels="My Travels",L.reports="My Reports",L.storage="Storage",L);const M={class:"mt-10"},y={class:"text-lg"};var P=t({data(){return{moduleLocksTableId:"moduleLocks",moduleLocks:[],isPageDataChanging:!1,lockStateChangeHooks:{[b.notes]:(e,a)=>{e&&!a&&o().getAll()}},headers:[{label:"id",isVisible:!1,dataValuePath:"id.value",dataIsComponentPath:null,dataComponentPropertiesPath:null},{label:this.$t("systemSettings.tab.modules.lock.table.headers.name.label"),dataValuePath:"name.value",dataIsComponentPath:"name.isComponent",dataComponentPropertiesPath:null},{label:this.$t("systemSettings.tab.modules.lock.table.headers.isLocked.label"),dataValuePath:"isLocked.value",dataIsComponentPath:"isLocked.isComponent",dataComponentPropertiesPath:"isLocked.componentProps",dataComponentModelValuePath:"isLocked.componentModelValue"}]}},components:{SimpleTable:e},computed:{data(){let e=[];for(let o of this.moduleLocks)e.push({values:{id:{value:o.name,isComponent:!1,isVisible:!1},name:{value:this.$t("other.moduleName.backendToFrontendMapping."+o.name),isComponent:!1},isLocked:{value:a,isComponent:!0,componentModelValue:o.isLocked,componentProps:{disabled:s.isDemo()}}}});return e}},methods:{isLocked(e){let a=this.moduleLocks.find((a=>a.name===e));if(!a)throw new n(`No lock data found for module named ${e}`);return a.isLocked},onComponentValueChange(e){this.isPageDataChanging||e.tableId==this.moduleLocksTableId&&this.$nextTick((()=>{this.onModuleLockChange()}))},async onModuleLockChange(){var e,a;let o=[];for(let d of this.$refs.table.rowsData){let t=null==(e=d.find((e=>"isLocked"===e.fieldId)))?void 0:e.uniqId,s=null==(a=d.find((e=>"id"===e.fieldId)))?void 0:a.value,i=this.$refs.table.componentValues[t];if(l.isUndefined(s)||l.isUndefined(i))throw new n("Could not read the module name or lock state",{colsData:d,isLocked:i,name:s});o.push({name:s,isLocked:i})}let t={moduleLocks:o},s=new g(m.SETTINGS_MODULES_LOCK_BASE,null,f,t);s.reload=!1,this.executeLockChangeHooks(o),await this.$moduleCall.update(s),await this.fetchModuleLocksData()},executeLockChangeHooks(e){let a=d.get(d.AUTHENTICATION_TOKEN);for(let o of e){let e=this.lockStateChangeHooks[o.name];if(e instanceof Function){let t=this.isLocked(o.name);i.authTokenUpdatePromise(a).then((()=>{e(t,o.isLocked)}))}}},async fetchModuleLocksData(){this.moduleLocks=await this.$moduleCall.getAll(m.SETTINGS_MODULES_LOCK_BASE)}},beforeMount(){this.fetchModuleLocksData()}},[["render",function(e,a,o,t,s,n){const l=c("SimpleTable");return r(),h("div",M,[u("h2",y,p(e.$t("systemSettings.tab.modules.lock.header")),1),n.data.length>0?(r(),k(l,{key:0,headers:s.headers,data:n.data,ref:"table",id:s.moduleLocksTableId,onComponentValueChange:n.onComponentValueChange,onBeforePageChange:a[0]||(a[0]=e=>s.isPageDataChanging=!0),onAfterTableRowsHandled:a[1]||(a[1]=e=>s.isPageDataChanging=!1)},null,8,["headers","data","id","onComponentValueChange"])):C("",!0)])}]]);export{P as default};
