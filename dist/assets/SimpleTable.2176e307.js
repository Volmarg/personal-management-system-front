import{c as e,b0 as t,b1 as a,aZ as r,_ as s,d as l,b2 as o,b3 as n,r as i,o as u,e as h,f as d,Y as c,g as p,aa as m,af as f,n as v,j as g,t as b,h as V,az as P,ag as y}from"./index.93e753e6.js";import{S}from"./SearchInput.c3a3a680.js";class C{static resolveKeysToValues(a,r){let s={};for(let l of r){if(e.isEmptyString(l,!1,!1)){s[l]=null;continue}let r=null;t.hasKey(a,l)&&(r=t.getValueForKey(a,l)),s[l]=r}return s}static resolveValueToKey(e,t){var a;return null!=(a=Object.keys(e).find((a=>e[a]===t)))?a:null}}const w={name:"SimpleTable",data:()=>({blockerString:"not-set",componentValues:{},searchValue:null,currentPage:1,visibleResults:[],searchMatchingResults:[]}),props:{id:{type:String,required:!1,default:""},canSearch:{type:Boolean,required:!1,default:!0},resultsPerPage:{type:Number,required:!1,default:10},headers:{type:Array,required:!0,validator(e){let t=()=>{l.info("Validation for property `header` has failed, check it's description for more information.")};for(let a of e){if(r.isUndefined(a.label))return l.error("Element from `headers` is missing property `label`",{element:a}),t(),!1;if(r.isUndefined(a.dataValuePath))return l.error("Element from `headers` is missing property `dataValuePath`",{element:a}),t(),!1;if(r.isUndefined(a.dataIsComponentPath))return l.error("Element from `headers` is missing property `dataIsComponentPath`",{element:a}),t(),!1;if(r.isUndefined(a.dataComponentPropertiesPath))return l.error("Element from `headers` is missing property `dataComponentPropertiesPath`",{element:a}),t(),!1}return!0}},data:{type:Array,required:!0,validator(e){let t=()=>{l.info("Validation for property `data` has failed, check it's description for more information.")};for(let a of e){if(r.isUndefined(a.values))return l.error("Element from `data` is missing property `values`",{element:a}),t(),!1;if(!r.isObject(a.values))return l.error("Property called `values` from element of `data` property` is not an object!",{element:a}),t(),!1;for(let e of Object.keys(a.values)){let s=a.values[e];if(r.isUndefined(s.value))return l.error("`values` property (object property) of an element in `data` property (vue property) is missing key `value`",{element:a,objectValue:s}),t(),!1;if(r.isUndefined(s.isComponent))return l.error("`values` property (object property) of an element in `data` property (vue property) is missing key `isComponent`",{element:a,objectValue:s}),t(),!1;if(s.isComponent&&r.isUndefined(s.componentProps))return l.error("Table element `data` property has incorrect structure",{reason:"One of the element.value object is a component but that object is missing property `componentProps`",element:a,objectValue:s}),t(),!1}}return!0}}},components:{Pagination:o,SearchInput:S},mixins:[{data:()=>({activeSortColumn:null,activeSortDirection:"asc"}),methods:{handleSort(e,t){let r=!1;if(0!==this.visibleResults.length&&!this.rowsData[0][t].isComponent){if(this.activeSortColumn=e.label,"desc"===this.activeSortDirection)return this.shouldSortNumber(r,t)&&(this.rowsData.sort(((e,a)=>a[t].value-e[t].value)),r=!0),this.shouldSortDate(r,t)&&(this.rowsData.sort(((e,r)=>a(r[t].value).valueOf()-a(e[t].value).valueOf())),r=!0),this.shouldSortString(r,t)&&this.rowsData.sort(((e,a)=>{var r,s;return(null!=(r=a[t].value)?r:"").localeCompare(null!=(s=e[t].value)?s:"")})),this.activeSortDirection="asc",void this.refresh(this.currentPage);this.shouldSortNumber(r,t)&&(this.rowsData.sort(((e,a)=>e[t].value-a[t].value)),r=!0),this.shouldSortDate(r,t)&&(this.rowsData.sort(((e,r)=>a(e[t].value).valueOf()-a(r[t].value).valueOf())),r=!0),this.shouldSortString(r,t)&&this.rowsData.sort(((e,a)=>{var r,s;return(null!=(r=e[t].value)?r:"").localeCompare(null!=(s=a[t].value)?s:"")})),this.activeSortDirection="desc",this.refresh(this.currentPage)}},shouldSortString(t,a){return!t&&(r.isString(this.rowsData[0][a].value)||e.isEmptyString(this.rowsData[0][a].value,!0,!0))},shouldSortDate(e,t){var r;return!e&&(null!=(r=this.rowsData[0][t].value)?r:"").match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)&&a(this.rowsData[0][t].value).isValid()},shouldSortNumber(e,t){return!e&&r.isNumber(this.rowsData[0][t].value)}}}],emits:["componentValueChange"],computed:{rowsData(){var e,t,a,r,s;let l=[];for(let o in this.data){let n=this.data[o],i=[];for(let l in this.headers){let u=this.headers[l],h=[u.dataValuePath,u.dataComponentModelValuePath,u.dataRawValuePath,u.dataIsComponentPath,u.dataComponentPropertiesPath],d=C.resolveKeysToValues(n.values,h),c=d[u.dataValuePath],p=null!=(e=d[u.dataRawValuePath])?e:c,m=d[u.dataIsComponentPath],f=null!=(t=d[u.dataComponentPropertiesPath])?t:null,v=null!=(a=d[u.dataComponentModelValuePath])?a:this.blockerString;i.push({uniqId:`idx${o}${l}`,modelValue:v,fieldName:u.label,fieldId:null!=(s=null==(r=u.dataValuePath)?void 0:r.split(".")[0])?s:null,value:c,rawValue:p,isComponent:m,componentProps:f})}l.push(i)}return l}},methods:{setComponentModelValue(e){void 0===this.componentValues[e.uniqId]&&e.isComponent&&e.modelValue!==this.blockerString&&(this.componentValues[e.uniqId]=e.modelValue)},isColumnVisible(e){return this.$refs[`header${e}`][0].classList.contains("hidden")},onPaginationPageNumberChange(e,t){this.currentPage=e,this.filterShownResults(e,t)},filterShownResults(e,t,a=!0){let r=[];this.searchMatchingResults=[],this.$nextTick((()=>{let s=(e-1)*t,l=0;for(let e of this.rowsData)if(l++,!(l<=s)&&this.matchesSearchValue(e)&&(r.push(e),r.length>=t))break;0===r.length&&a&&(this.currentPage=1,this.filterShownResults(1,t,!1)),this.visibleResults=r}))},matchesSearchValue(e){if(!this.searchValue)return!0;for(let t of e)if(r.isScalar(t.value)){if(r.isString(t.value)&&t.value.toLowerCase().includes(this.searchValue.toLowerCase()))return this.searchMatchingResults.push(e),!0;if(r.isNumber(t.value)&&t.value.toString().includes(this.searchValue))return this.searchMatchingResults.push(e),!0;if(r.isBoolean(t.value)&&t.value===n.boolStringToRealBool(this.searchValue))return this.searchMatchingResults.push(e),!0}return!1},refresh(e){this.filterShownResults(e,this.resultsPerPage)}},created(){this.filterShownResults(this.currentPage,this.resultsPerPage)},watch:{searchValue(){this.currentPage=1,this.refresh(this.currentPage)},data(){this.refresh(this.currentPage)}}},D={class:"flex justify-end"},k={class:"table mt-2"},R=["onClick"],I={key:0},j={key:0,class:"sort-arrow"},$={key:1,class:"sort-arrow"},q={key:1},N={key:0};var M=s(w,[["render",function(e,t,a,r,s,l){const o=i("SearchInput"),n=i("fa"),S=i("Pagination");return u(),h("div",null,[d("div",D,[a.canSearch?(u(),c(o,{key:0,modelValue:s.searchValue,"onUpdate:modelValue":t[0]||(t[0]=e=>s.searchValue=e),modelModifiers:{trim:!0}},null,8,["modelValue"])):p("",!0)]),d("table",k,[d("thead",null,[d("tr",null,[(u(!0),h(m,null,f(a.headers,((t,a)=>(u(),h("th",{key:a,class:v(["font-bold uppercase cursor-pointer hover:opacity-80",{hidden:!1===t.isVisible}]),onClick:r=>e.handleSort(t,a),ref_for:!0,ref:`header${a}`},[g(b(t.label)+" ",1),t.label===e.activeSortColumn?(u(),h("span",I,["desc"===e.activeSortDirection?(u(),h("span",j,[V(n,{icon:"sort-up"})])):p("",!0),"asc"===e.activeSortDirection?(u(),h("span",$,[V(n,{icon:"sort-down"})])):p("",!0)])):p("",!0)],10,R)))),128))])]),d("tbody",null,[(u(!0),h(m,null,f(s.visibleResults,((t,r)=>(u(),h("tr",{key:r},[(u(!0),h(m,null,f(t,((r,o)=>(u(),h("td",{key:o,class:v({hidden:l.isColumnVisible(o)})},[g(b(l.setComponentModelValue(r))+" ",1),r.isComponent?(u(),c(y(r.value),P({key:0},{...r.componentProps,rowData:t},{modelValue:s.componentValues[`${r.uniqId}`],"onUpdate:modelValue":e=>s.componentValues[`${r.uniqId}`]=e,ref_for:!0,ref:`component${r.uniqId}`,onChange:l=>{var n,i;return e.$emit("componentValueChange",{value:s.componentValues[`${r.uniqId}`],component:null!=(n=e.$refs[`component${r.uniqId}`])?n:null,header:null!=(i=e.$refs[`header${o}`])?i:null,cellData:r,rowData:t,cellNumber:o,rowNumber:t.realRowId,tableId:a.id})}}),null,16,["modelValue","onUpdate:modelValue","onChange"])):(u(),h("span",q,[l.isColumnVisible(o)?p("",!0):(u(),h("span",N,b(r.value),1))]))],2)))),128))])))),128))])]),V(S,{"number-of-results":s.searchValue?s.searchMatchingResults.length:l.rowsData.length,"initial-current-page":s.currentPage,"initial-count-of-result-per-page":a.resultsPerPage,onPageNumberChanges:l.onPaginationPageNumberChange,class:"mt-2"},null,8,["number-of-results","initial-current-page","initial-count-of-result-per-page","onPageNumberChanges"])])}]]);export{M as S};
