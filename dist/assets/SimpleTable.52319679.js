import{c as e,b2 as t,b3 as a,a$ as r,_ as s,d as l,b4 as n,b5 as o,b6 as i,r as u,R as h,o as d,e as c,f as m,W as p,Y as f,g,ab as v,ag as b,n as P,aC as V,j as y,t as C,h as S,X as w,aB as R,ah as D}from"./index.fd0df9df.js";import{S as k}from"./SearchInput.b68237e1.js";import{_ as N}from"./VuelidateHandler.0ca821ed.js";class I{static resolveKeysToValues(a,r){let s={};for(let l of r){if(e.isEmptyString(l,!1,!1)){s[l]=null;continue}let r=null;t.hasKey(a,l)&&(r=t.getValueForKey(a,l)),s[l]=r}return s}static resolveValueToKey(e,t){var a;return null!=(a=Object.keys(e).find((a=>e[a]===t)))?a:null}}const q={methods:{buildCellUniqueId:(e,t)=>`idx${e}${t}`,buildComponentRefName:e=>`component${e}`,buildHeaderRefName:e=>`header${e}`}},j={name:"SimpleTable",data:()=>({blockerValue:void 0,componentValues:{},searchValue:null,currentPage:1,visibleResults:[],searchMatchingResults:[],validationErrors:{}}),props:{navigationOnTop:{type:Boolean,required:!1,default:!1},tableDirectWrapperClasses:{type:String,required:!1,default:""},overflowXAuto:{type:Boolean,required:!1,default:!0},id:{type:String,required:!1,default:""},canSearch:{type:Boolean,required:!1,default:!0},resultsPerPage:{type:Number,required:!1,default:10},headers:{type:Array,required:!0,validator(e){let t=()=>{l.info("Validation for property `header` has failed, check it's description for more information.")};for(let a of e){if(r.isUndefined(a.label))return l.error("Element from `headers` is missing property `label`",{element:a}),t(),!1;if(r.isUndefined(a.dataValuePath))return l.error("Element from `headers` is missing property `dataValuePath`",{element:a}),t(),!1;if(r.isUndefined(a.dataIsComponentPath))return l.error("Element from `headers` is missing property `dataIsComponentPath`",{element:a}),t(),!1;if(r.isUndefined(a.dataComponentPropertiesPath))return l.error("Element from `headers` is missing property `dataComponentPropertiesPath`",{element:a}),t(),!1}return!0}},data:{type:Array,required:!0,validator(e){let t=()=>{l.info("Validation for property `data` has failed, check it's description for more information.")};for(let a of e){if(r.isUndefined(a.values))return l.error("Element from `data` is missing property `values`",{element:a}),t(),!1;if(!r.isObject(a.values))return l.error("Property called `values` from element of `data` property` is not an object!",{element:a}),t(),!1;for(let e of Object.keys(a.values)){let s=a.values[e];if(r.isUndefined(s.value))return l.error("`values` property (object property) of an element in `data` property (vue property) is missing key `value`",{element:a,objectValue:s}),t(),!1;if(r.isUndefined(s.isComponent))return l.error("`values` property (object property) of an element in `data` property (vue property) is missing key `isComponent`",{element:a,objectValue:s}),t(),!1;if(s.isComponent&&r.isUndefined(s.componentProps))return l.error("Table element `data` property has incorrect structure",{reason:"One of the element.value object is a component but that object is missing property `componentProps`",element:a,objectValue:s}),t(),!1}}return!0}}},components:{Pagination:n,SearchInput:k},mixins:[{data:()=>({activeSortColumn:null,activeSortDirection:"asc"}),methods:{handleSort(e,t){let r=!1;if(0!==this.visibleResults.length&&!this.rowsData[0][t].isComponent){if(this.activeSortColumn=e.label,"desc"===this.activeSortDirection)return this.shouldSortNumber(r,t)&&(this.rowsData.sort(((e,a)=>a[t].value-e[t].value)),r=!0),this.shouldSortDate(r,t)&&(this.rowsData.sort(((e,r)=>a(r[t].value).valueOf()-a(e[t].value).valueOf())),r=!0),this.shouldSortString(r,t)&&this.rowsData.sort(((e,a)=>{var r,s;return(null!=(r=a[t].value)?r:"").localeCompare(null!=(s=e[t].value)?s:"")})),this.activeSortDirection="asc",void this.refresh(this.currentPage);this.shouldSortNumber(r,t)&&(this.rowsData.sort(((e,a)=>e[t].value-a[t].value)),r=!0),this.shouldSortDate(r,t)&&(this.rowsData.sort(((e,r)=>a(e[t].value).valueOf()-a(r[t].value).valueOf())),r=!0),this.shouldSortString(r,t)&&this.rowsData.sort(((e,a)=>{var r,s;return(null!=(r=e[t].value)?r:"").localeCompare(null!=(s=a[t].value)?s:"")})),this.activeSortDirection="desc",this.refresh(this.currentPage)}},shouldSortString(t,a){return!t&&(r.isString(this.rowsData[0][a].value)||e.isEmptyString(this.rowsData[0][a].value,!0,!0))},shouldSortDate(e,t){var r;return!e&&(null!=(r=this.rowsData[0][t].value)?r:"").match(/^[0-9]{4}-[0-9]{2}-[0-9]{2}/)&&a(this.rowsData[0][t].value).isValid()},shouldSortNumber(e,t){return!e&&r.isNumber(this.rowsData[0][t].value)}}},o,N,q],emits:["beforePageChange","afterTableRowsHandled","componentValueChange","update:componentModelValue","action"],computed:{rowsData(){var e,t,a,r,s,l;let n=[];for(let o in this.data){let i=this.data[o],u=[];for(let n in this.headers){let h=this.headers[n],d=[h.dataValuePath,h.dataComponentModelValuePath,h.dataRawValuePath,h.dataIsComponentPath,h.dataComponentPropertiesPath,h.dataValidations],c=I.resolveKeysToValues(i.values,d),m=c[h.dataValuePath],p=null!=(e=c[h.dataRawValuePath])?e:m,f=c[h.dataIsComponentPath],g=null!=(t=c[h.dataComponentPropertiesPath])?t:null,v=null!=(a=c[h.dataValidations])?a:[],b=null!=(r=c[h.dataComponentModelValuePath])?r:this.blockerValue;u.push({uniqId:this.buildCellUniqueId(o,n),modelValue:b,fieldName:h.label,fieldId:null!=(l=null==(s=h.dataValuePath)?void 0:s.split(".")[0])?l:null,value:m,rawValue:p,isComponent:f,columnStyles:String(h.columnStyles),componentProps:g,validations:v,rowIndex:o})}n.push(u)}return n},areComponentsValuesValid(){return 0===Object.keys(this.validationErrors).length}},methods:{validateComponentsValues(){this.validationErrors={};for(let e of this.rowsData)for(let t of e){let e=this.validateValue(this.componentValues[t.uniqId],t.validations);e.length>0&&(this.validationErrors[t.uniqId]=e[0])}},getComponentUpdateEventArgs(e,t,a,r){var s,l;let n=this.buildComponentRefName(e.uniqId),o=this.buildHeaderRefName(a);return{value:this.componentValues[e.uniqId],component:null!=(s=this.$refs[n])?s:null,header:null!=(l=this.$refs[o])?l:null,cellData:e,rowData:t,cellNumber:a,rowNumber:this.getRowNumber(r),page:this.currentPage,resultsPerPage:this.resultsPerPage,tableId:this.id}},getRowNumber(e){return this.getPaginatedIndex(e,this.currentPage,this.resultsPerPage)},setComponentModelValue(e){e.isComponent&&(e.modelValue,this.blockerValue),this.componentValues[e.uniqId]=e.modelValue},isColumnVisible(e){let t=this.buildHeaderRefName(e);return this.$refs[t][0].classList.contains("hidden")},onPaginationPageNumberChange(e,t){this.currentPage=e,this.$emit("beforePageChange"),this.filterShownResults(e,t)},filterShownResults(e,t,a=!0){let r=[];this.searchMatchingResults=[],this.$nextTick((()=>{let s=(e-1)*t,l=0;for(let e of this.rowsData)if(l++,!(l<=s)&&this.matchesSearchValue(e)&&(r.push(e),r.length>=t))break;0===r.length&&a&&(this.currentPage=1,this.filterShownResults(1,t,!1)),this.visibleResults=r}))},matchesSearchValue(e){if(!this.searchValue)return!0;for(let t of e)if(r.isScalar(t.value)){if(r.isString(t.value)&&t.value.toLowerCase().includes(this.searchValue.toLowerCase()))return this.searchMatchingResults.push(e),!0;if(r.isNumber(t.value)&&t.value.toString().includes(this.searchValue))return this.searchMatchingResults.push(e),!0;if(r.isBoolean(t.value)&&t.value===i.boolStringToRealBool(this.searchValue))return this.searchMatchingResults.push(e),!0}return!1},refresh(e){this.filterShownResults(e,this.resultsPerPage)},initComponentValues(){for(let e of this.rowsData)for(let t of e)this.setComponentModelValue(t)}},created(){this.filterShownResults(this.currentPage,this.resultsPerPage),this.initComponentValues()},watch:{searchValue(){this.currentPage=1,this.refresh(this.currentPage)},data(){this.refresh(this.currentPage),this.initComponentValues()},visibleResults(){for(let e of this.visibleResults)for(let t of e)this.setComponentModelValue(t)}}},E={class:"simple-table"},M={class:"flex justify-end"},U={class:"table mt-2"},$=["onClick"],T={key:0},O={key:0,class:"sort-arrow"},x={key:1,class:"sort-arrow"},H={key:1},A=["innerHTML"],B={class:"text-red-500 text-center mt-1"};var K=s(j,[["render",function(e,t,a,r,s,l){const n=u("SearchInput"),o=u("Pagination"),i=u("fa"),k=h("last-loop-element");return d(),c("div",E,[m("div",M,[p(e.$slots,"toltipStart"),a.canSearch?(d(),f(n,{key:0,modelValue:s.searchValue,"onUpdate:modelValue":t[0]||(t[0]=e=>s.searchValue=e),modelModifiers:{trim:!0}},null,8,["modelValue"])):g("",!0),p(e.$slots,"toltipEnd")]),a.navigationOnTop?(d(),f(o,{key:0,"number-of-results":s.searchValue?s.searchMatchingResults.length:l.rowsData.length,"initial-current-page":s.currentPage,"initial-count-of-result-per-page":a.resultsPerPage,onPageNumberChanges:l.onPaginationPageNumberChange,class:"mt-2"},null,8,["number-of-results","initial-current-page","initial-count-of-result-per-page","onPageNumberChanges"])):g("",!0),m("div",{class:P(["overflow-x-auto overflow-hidden",{[a.tableDirectWrapperClasses]:!0}])},[m("table",U,[m("thead",null,[m("tr",null,[(d(!0),c(v,null,b(a.headers,((t,a)=>(d(),c("th",{key:a,class:P(["font-bold uppercase cursor-pointer hover:opacity-80",{hidden:!1===t.isVisible}]),style:V(t.columnStyles),onClick:r=>e.handleSort(t,a),ref_for:!0,ref:e.buildHeaderRefName(a)},[y(C(t.label)+" ",1),t.label===e.activeSortColumn?(d(),c("span",T,["desc"===e.activeSortDirection?(d(),c("span",O,[S(i,{icon:"sort-up"})])):g("",!0),"asc"===e.activeSortDirection?(d(),c("span",x,[S(i,{icon:"sort-down"})])):g("",!0)])):g("",!0)],14,$)))),128))])]),m("tbody",null,[(d(!0),c(v,null,b(s.visibleResults,((t,r)=>w((d(),c("tr",{key:JSON.stringify(t)},[(d(!0),c(v,null,b(t,((n,o)=>(d(),c("td",{key:o,class:P({hidden:l.isColumnVisible(o)})},[n.isComponent?(d(),f(D(n.value),R({key:0},{...n.componentProps,rowData:t},{modelValue:s.componentValues[n.uniqId],"onUpdate:modelValue":[e=>s.componentValues[n.uniqId]=e,a=>e.$emit("update:componentModelValue",l.getComponentUpdateEventArgs(n,t,o,r))],ref_for:!0,ref:e.buildComponentRefName(n.uniqId),onChange:a=>e.$emit("componentValueChange",l.getComponentUpdateEventArgs(n,t,o,r)),onAction:t=>e.$emit("action",{originalEvent:t,rowNumber:r+(s.currentPage>1?(s.currentPage-1)*a.resultsPerPage:0)})}),null,16,["modelValue","onUpdate:modelValue","onChange","onAction"])):(d(),c("span",H,[l.isColumnVisible(o)?g("",!0):(d(),c("span",{key:0,class:"break-all",innerHTML:n.value},null,8,A))])),m("p",B,C(s.validationErrors[n.uniqId]),1)],2)))),128))])),[[k,{index:r,callback:()=>e.$emit("afterTableRowsHandled")}]]))),128))])])],2),a.navigationOnTop?g("",!0):(d(),f(o,{key:1,"number-of-results":s.searchValue?s.searchMatchingResults.length:l.rowsData.length,"initial-current-page":s.currentPage,"initial-count-of-result-per-page":a.resultsPerPage,onPageNumberChanges:l.onPaginationPageNumberChange,class:"mt-2"},null,8,["number-of-results","initial-current-page","initial-count-of-result-per-page","onPageNumberChanges"]))])}]]);export{K as S,q as _};
